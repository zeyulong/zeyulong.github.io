

<!DOCTYPE html>
<html lang="zh-CN" >



<head><!-- hexo injector head_begin start --><progress id="content_progress" value="0"></progress><!-- hexo injector head_begin end -->
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/theme/TamakoAvatar-new-zip.png">
  <link rel="icon" href="/img/theme/TamakoAvatar-new-zip.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#000000">
  <meta name="author" content="龙泽雨">
  <meta name="keywords" content="">
  
    <meta name="description" content="本文主要记录了自己对事件相机进行选型、标定和使用的过程。型号为双目DAVIS346 Color。另外，普通相机也可以参考其中使用Kalibr进行标定的过程。">
<meta property="og:type" content="article">
<meta property="og:title" content="事件相机的选型、标定和使用">
<meta property="og:url" content="http://zeyulong.com/posts/9d7fd48f/index.html">
<meta property="og:site_name" content="龙泽雨的博客">
<meta property="og:description" content="本文主要记录了自己对事件相机进行选型、标定和使用的过程。型号为双目DAVIS346 Color。另外，普通相机也可以参考其中使用Kalibr进行标定的过程。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://zeyulong.com/posts/9d7fd48f/%E4%BA%A7%E5%93%81%E7%BB%86%E8%8A%82-1.png">
<meta property="og:image" content="http://zeyulong.com/posts/9d7fd48f/%E4%BA%A7%E5%93%81%E7%BB%86%E8%8A%82-2.png">
<meta property="og:image" content="http://zeyulong.com/posts/9d7fd48f/dv-gui%E5%8F%AF%E8%A7%86%E5%8C%96.png">
<meta property="og:image" content="http://zeyulong.com/posts/9d7fd48f/rpg_dvs_ros%E5%8F%AF%E8%A7%86%E5%8C%96.png">
<meta property="og:image" content="http://zeyulong.com/posts/9d7fd48f/dv-ros%E5%8F%AF%E8%A7%86%E5%8C%96.png">
<meta property="og:image" content="http://zeyulong.com/posts/9d7fd48f/%E5%9B%BA%E4%BB%B6%E6%9B%B4%E6%96%B0%E7%95%8C%E9%9D%A2.png">
<meta property="og:image" content="http://zeyulong.com/posts/9d7fd48f/DAVIS346%E7%9B%B8%E6%9C%BA%E9%95%9C%E5%A4%B4.png">
<meta property="og:image" content="http://zeyulong.com/posts/9d7fd48f/siemens-star.gif">
<meta property="og:image" content="http://zeyulong.com/posts/9d7fd48f/focus-notfocus.png">
<meta property="og:image" content="http://zeyulong.com/posts/9d7fd48f/focus-infocus.png">
<meta property="og:image" content="http://zeyulong.com/posts/9d7fd48f/%E4%BD%BF%E7%94%A8Kalibr%E8%BF%9B%E8%A1%8C%E5%AF%B9%E7%84%A6.png">
<meta property="og:image" content="http://zeyulong.com/posts/9d7fd48f/DAVIS346%E6%A0%87%E5%AE%9A%E7%95%8C%E9%9D%A2%E8%AE%BE%E7%BD%AE.png">
<meta property="og:image" content="http://zeyulong.com/posts/9d7fd48f/calibration-highlights.png">
<meta property="og:image" content="http://zeyulong.com/posts/9d7fd48f/%E6%A0%87%E5%AE%9AKeep.png">
<meta property="og:image" content="http://zeyulong.com/posts/9d7fd48f/%E6%B5%8B%E9%87%8F%E6%A0%87%E5%AE%9A%E6%9D%BF%E7%9A%84tagSize.png">
<meta property="og:image" content="http://zeyulong.com/posts/9d7fd48f/%E9%87%8D%E6%8A%95%E5%BD%B1%E8%AF%AF%E5%B7%AE%E7%A4%BA%E4%BE%8B.png">
<meta property="og:image" content="http://zeyulong.com/posts/9d7fd48f/%E9%AA%8C%E8%AF%81%E5%99%A8%E7%BB%93%E6%9E%9C-%E5%8D%95%E7%9B%AE%E7%9B%B8%E6%9C%BA.png">
<meta property="og:image" content="http://zeyulong.com/posts/9d7fd48f/%E9%AA%8C%E8%AF%81%E5%99%A8%E7%BB%93%E6%9E%9C-%E5%8F%8C%E7%9B%AE%E7%9B%B8%E6%9C%BA.png">
<meta property="og:image" content="http://zeyulong.com/posts/9d7fd48f/gyr_n-symbol.svg">
<meta property="og:image" content="http://zeyulong.com/posts/9d7fd48f/gyr_n-units.svg">
<meta property="og:image" content="http://zeyulong.com/posts/9d7fd48f/acc_n-symbol.svg">
<meta property="og:image" content="http://zeyulong.com/posts/9d7fd48f/acc_n-unites.svg">
<meta property="og:image" content="http://zeyulong.com/posts/9d7fd48f/gyr_w-symbol.svg">
<meta property="og:image" content="http://zeyulong.com/posts/9d7fd48f/gyr_w-unites.svg">
<meta property="og:image" content="http://zeyulong.com/posts/9d7fd48f/acc_w-symbol.svg">
<meta property="og:image" content="http://zeyulong.com/posts/9d7fd48f/acc_w-unites.svg">
<meta property="og:image" content="http://zeyulong.com/posts/9d7fd48f/IMU%E6%96%B9%E5%90%91%E5%AE%9A%E4%B9%89.png">
<meta property="og:image" content="http://zeyulong.com/posts/9d7fd48f/IMU%E5%BD%95%E5%88%B6%E7%BB%93%E6%9E%84.png">
<meta property="og:image" content="http://zeyulong.com/posts/9d7fd48f/%E6%B5%8B%E9%87%8F%E6%A0%87%E5%AE%9A%E6%9D%BF%E7%9A%84tagSize.png">
<meta property="og:image" content="http://zeyulong.com/posts/9d7fd48f/IMU%E8%AF%AF%E5%B7%AE%E7%A4%BA%E4%BE%8B-1.png">
<meta property="og:image" content="http://zeyulong.com/posts/9d7fd48f/IMU%E8%AF%AF%E5%B7%AE%E7%A4%BA%E4%BE%8B-2.png">
<meta property="og:image" content="http://zeyulong.com/posts/9d7fd48f/IMU%E8%AF%AF%E5%B7%AE%E7%A4%BA%E4%BE%8B-3.png">
<meta property="og:image" content="http://zeyulong.com/posts/9d7fd48f/%E5%9C%88%E5%86%85%E6%98%AF3-sigma%E8%8C%83%E5%9B%B4.png">
<meta property="og:image" content="http://zeyulong.com/posts/9d7fd48f/kalibr_accel_err.png">
<meta property="og:image" content="http://zeyulong.com/posts/9d7fd48f/%E9%87%8D%E6%8A%95%E5%BD%B1%E8%AF%AF%E5%B7%AE%E7%A4%BA%E4%BE%8B.png">
<meta property="og:image" content="http://zeyulong.com/posts/9d7fd48f/record-ui.png">
<meta property="og:image" content="http://zeyulong.com/posts/9d7fd48f/%E5%8F%8C%E7%9B%AE%E7%A1%AC%E4%BB%B6%E8%BF%9E%E6%8E%A5.jpg">
<meta property="article:published_time" content="2024-04-20T02:22:09.000Z">
<meta property="article:modified_time" content="2025-07-17T02:25:17.048Z">
<meta property="article:author" content="龙泽雨">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://zeyulong.com/posts/9d7fd48f/%E4%BA%A7%E5%93%81%E7%BB%86%E8%8A%82-1.png">
  
  
  
  <title>事件相机的选型、标定和使用 - 龙泽雨的博客</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  



  
<link rel="stylesheet" href="/custom/Markdown/macpanel.css">
<link rel="stylesheet" href="/custom/Fonts/CodeFont.css">
<link rel="stylesheet" href="/custom/Fonts/inlinecode-bg-color.css">
<link rel="stylesheet" href="/custom/live2d/font-awesome.min.css">
<link rel="stylesheet" href="/custom/LoadingBar/pace-theme-corner-indicator.css">
<link rel="stylesheet" href="/custom/ReadingProgress/ReadingProgress.css">
<link rel="stylesheet" href="/custom/SelectBackgroundColor/SelectBackgroundColor.css">
<link rel="stylesheet" href="/custom/waline/gif.css">



  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"zeyulong.com","root":"/","version":"1.9.7","typing":{"enable":false,"typeSpeed":100,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":"8gUBTaCjmaSbnf4genwggan3-MdYXbMMI","app_key":"2WRxjgxRXIWRBo8EA4205Wfm","server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<!-- hexo injector head_end start --><link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@200;300;400;500;600;700;900&display=swap" rel="stylesheet"><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.0.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Hello, world!</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" target="_self" href="javascript:;" role="button"
                 data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <i class="iconfont icon-steam"></i>
                <span>摸鱼</span>
              </a>
              <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                
                  
                  
                  
                  <a class="dropdown-item" href="/game/2048" target="_self">
                    
                    <span>2048</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/game/bcbk/1" target="_self">
                    
                    <span>别踩白块-1</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/game/bcbk/2" target="_self">
                    
                    <span>别踩白块-2</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/game/dblk" target="_self">
                    
                    <span>躲避绿块</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/game/dr" target="_self">
                    
                    <span>恐龙快跑</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="https://mario-kart-3-js.vercel.app/" target="_self">
                    
                    <span>马里奥赛车</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/game/mf" target="_self">
                    
                    <span>魔方</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/game/cat" target="_self">
                    
                    <span>圈小猫</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/game/sl" target="_self">
                    
                    <span>扫雷</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/game/txz" target="_self">
                    
                    <span>推箱子</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/game/wzq" target="_self">
                    
                    <span>五子棋</span>
                  </a>
                
              </div>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/theme/GirlWithCat-cut.jpg') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle">事件相机的选型、标定和使用</span>
          
        </div>

        
          
  <div class="mt-3">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-author" aria-hidden="true"></i>
        龙泽雨
      </span>
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2024-04-20 10:22" pubdate>
          2024年4月20日 上午
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          19k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          161 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">事件相机的选型、标定和使用</h1>
            
              <p id="updated-time" class="note note-info" style="">
                
                  
                    本文最后更新于 2025年7月17日 上午
                  
                
              </p>
            
            
              <div class="markdown-body">
                
                <p>本文主要记录了自己对事件相机进行选型、标定和使用的过程。型号为双目DAVIS346 Color。另外，普通相机也可以参考其中使用Kalibr进行标定的过程。</p>
<span id="more"></span>
<h1 id="选型">选型</h1>
<h2 id="主流事件相机厂家信息">主流事件相机厂家信息</h2>
<p>此处主要摘自<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/wq5CJVFCKgi5GdWrIBB_dw">参考链接</a>。</p>
<h3 id="iniVation">iniVation</h3>
<ul>
<li>
<p>公司官网：<a target="_blank" rel="noopener" href="https://inivation.com/">https://inivation.com/</a></p>
</li>
<li>
<p>全球销售官网：<a target="_blank" rel="noopener" href="https://shop.inivation.com/collections">https://shop.inivation.com/collections</a></p>
</li>
<li>
<p>中国区官网：<a target="_blank" rel="noopener" href="http://www.inivation.cn/">http://www.inivation.cn/</a> （或 <a target="_blank" rel="noopener" href="https://www.yixinkeyan.com/">https://www.yixinkeyan.com/</a> ，他们是合作单位）</p>
</li>
<li>
<p>在售产品：DAVIS346 (mono&amp;rgb) / DVXplorer (lite/mini)等</p>
</li>
<li>
<p>参考售价：DAVIS346 约4.8万元（学术价格）</p>
</li>
<li>
<p>购买方式：需从中国区销售代理进行购买。在中国区官网留言板留言购买，或拨打官网给出的联系电话，或直接加微信咨询销售。</p>
</li>
<li>
<p>官方手册：全球官网提供了各种产品手册，或可以购买后向销售索要。</p>
</li>
<li>
<p>官方软件网站：<a target="_blank" rel="noopener" href="https://docs.inivation.com/">https://docs.inivation.com/</a></p>
</li>
</ul>
<p><strong>其他说明：</strong></p>
<ol>
<li>进出口关税等原因，国内售价高出全球销售的售价不少，参考预算时不要按照全球销售的网站计算。</li>
<li>货源来自国外，发货时间是附全款后两周。</li>
<li>用于科研的话是按照学术价格（academic）购买，会便宜不少。提供相应证明资料即可。</li>
</ol>
<h3 id="CeleX">CeleX</h3>
<ul>
<li>
<p>官方网站：<a target="_blank" rel="noopener" href="https://www.omnivision-group.com/#/technology/haowei-sibike">https://www.omnivision-group.com/#/technology/haowei-sibike</a></p>
</li>
<li>
<p>在售产品：CeleX5_MP</p>
</li>
<li>
<p>参考售价：15820元</p>
</li>
<li>
<p>基本信息：芯仑第5代事件相机，分辨率1280x800</p>
</li>
<li>
<p>企业名称：豪威芯仑传感器（上海）有限公司</p>
</li>
<li>
<p>购买方式：发送邮件到 <a href="mailto:evs_sample@ovt.com">evs_sample@ovt.com</a> 咨询。</p>
</li>
<li>
<p>官方资料：<a target="_blank" rel="noopener" href="https://github.com/CelePixel/CeleX5-MIPI">https://github.com/CelePixel/CeleX5-MIPI</a></p>
</li>
</ul>
<p><strong>其他说明：</strong></p>
<ol>
<li>公司原名是“上海芯仑光电科技有限公司”，官网是<a target="_blank" rel="noopener" href="http://www.celepixel.com">http://www.celepixel.com</a>。公司改名成了现在的“豪威芯仑”，但产品没有任何变化。</li>
<li>购买时，销售会提供销售合同。签完合同并付款后，公司基本上当天就能够从上海发出产品，感觉货源较为充足。</li>
<li>官方的github包括了完整的软件、说明书和代码。</li>
</ol>
<h3 id="Prophesee">Prophesee</h3>
<ul>
<li>官方资讯链接：<a target="_blank" rel="noopener" href="https://www.prophesee.ai/contact-us/">https://www.prophesee.ai/contact-us/</a></li>
<li>在售产品与参考售价：EVKV1(4.5w) / EVKV2(6.3w) / VGA EVK(3w) 等。</li>
<li>购买方式：官网提交咨询表单，官方会转给中国区负责人进行联系；或关注国内的公众号：Prophesee，在公众号内寻找联系方式咨询。</li>
<li>官方资料：购买完成后，签署NDA后开放对应资料。</li>
</ul>
<p><strong>其他说明：</strong></p>
<ol>
<li>Prophesee官方还能够提供公司开发的代码源码，但购买费用较高，大概要10w+，如有需求可以咨询。</li>
<li>购买后记得索要资料。</li>
<li>货源也是来自国外，合同上发货时间是附全款后三周。</li>
<li>如需开具发票要注意，prophesee的发票项目名称是不能够修改的，单位如果对采购项目名称有要求，需提前确认发票名称是否可以走账报销。</li>
</ol>
<h2 id="事件相机的关键参数">事件相机的关键参数</h2>
<p><a target="_blank" rel="noopener" href="https://docs.inivation.com/hardware/hardware-advanced-usage/white-paper.html">iniVation提供的白皮书</a>：本白皮书涉及了解基于神经形态事件的视觉传感器的性能，特别是时间分辨率、同步与异步读出、动态范围和低光性能。</p>
<p>下面的结果由GPT-4生成。</p>
<p>购买事件相机（Event Camera）时，您需要关注以下关键参数以确保选购的设备最适合您的应用需求：</p>
<ol>
<li>
<p><strong>时间分辨率（Temporal Resolution）</strong>：事件相机的时间分辨率通常非常高，能够达到微秒级（μs）甚至更高，这决定了相机捕捉场景变化的能力。高时间分辨率意味着相机能够记录更加细腻和快速的场景变动。</p>
<p>事件相机的时间分辨率决定了相机捕捉场景变化的精细程度，即相机能够在多短的时间内检测到光线变化。具体到1微秒（1us）和200微秒（200us）的时间分辨率，1us的时间分辨率明显更高，意味着相机能够更精细地、在更短的时间内捕捉到光线的变化，对于动态场景的捕捉能力更强。</p>
</li>
<li>
<p><strong>对比度灵敏度（Contrast Sensitivity）</strong>：事件相机是基于像素检测亮度变化的，对比度灵敏度是指相机能够检测到的最小亮度变化阈值。更高的对比度灵敏度意味着相机能够在更低的亮度变化下触发事件，捕捉更微小的场景变化。</p>
</li>
<li>
<p><strong>动态范围（Dynamic Range）</strong>：动态范围是指相机能够同时捕捉到的最亮和最暗区域的比率，单位通常为dB。事件相机的动态范围非常高，可以超过130dB，使其能够在极端光照条件下仍然保持性能，这对于户外应用或光照条件快速变化的场景非常关键。</p>
<p>因此，如果比较13%的对比度灵敏度和20%的对比度灵敏度，20%的对比度灵敏度更好。这是因为它表明相机能够在更细微的亮度变化下触发事件，从而捕捉到更多的场景细节和动态信息。</p>
</li>
<li>
<p><strong>空间分辨率（Spatial Resolution）</strong>：这指的是相机的像素数目，即相机能够捕捉到的细节程度。虽然事件相机的空间分辨率通常不如传统相机，但对于许多应用来说仍然足够。</p>
</li>
<li>
<p>事件相机的最大吞吐量是指相机在单位时间内能够处理和输出的最大事件数量。这个参数直接影响到事件相机的性能，尤其是在光照条件变化剧烈或场景动态变化快速时的表现。</p>
</li>
<li>
<p>相机的视场角（FOV）。</p>
</li>
</ol>
<h2 id="iniVation-2">iniVation</h2>
<p>实验室考虑购进iniVation公司的事件相机。</p>
<h3 id="公司简介">公司简介</h3>
<p><a target="_blank" rel="noopener" href="https://inivation.com/">公司官网</a></p>
<p><a target="_blank" rel="noopener" href="https://inivation.cn">中国分公司官网</a></p>
<p><strong>iniVation</strong>起源于瑞士苏黎世大学(University of Zurich)和苏黎世联邦理工学院(ETH Zurich)，目前作为<strong>基于事件的动态视觉传感器(DVS)技术</strong>的市场引领者之一，服务了全球超过250个组织和团队，客户覆盖全球五大洲，应用领域包括汽车、消费电子、机器人、工业视觉和航空航天等领域。上海再度科技有限公司作为中国区独家总代理，负责其产品在中国区的产品销售、市场营销和客户支持。</p>
<h3 id="产品细节">产品细节</h3>
<p>经调研和经销商交流，iniVation公司的事件相机具体产品细节如下：</p>
<blockquote>
<ul>
<li>官方规格书在 <a target="_blank" rel="noopener" href="https://inivation.com/buy/">https://inivation.com/buy/</a> 下的<code>SPECIFICATIONS</code>按钮处，因为考虑到官方的PDF链接后续可能会发生改变，所以这里给出了找规格书的位置，而没有直接给出PDF链接。</li>
<li>或者在<a target="_blank" rel="noopener" href="https://docs.inivation.com/hardware/current-products/index.html">此处</a>查看网页版的规格书。</li>
</ul>
</blockquote>
<img src="/posts/9d7fd48f/%E4%BA%A7%E5%93%81%E7%BB%86%E8%8A%82-1.png" srcset="/img/loading.gif" lazyload class="" title="产品细节-1">
<img src="/posts/9d7fd48f/%E4%BA%A7%E5%93%81%E7%BB%86%E8%8A%82-2.png" srcset="/img/loading.gif" lazyload class="" title="产品细节-2">
<blockquote>
<ol>
<li>官方报价是在 <a target="_blank" rel="noopener" href="https://shop.inivation.com/collections">https://shop.inivation.com/collections</a> 下找到的学术价格（截止2024年5月14日）。</li>
<li>人民币和欧元汇率按照7.81 : 1计算。实际大陆报价还要含超过10%税。</li>
<li>大陆的报价不知道方不方便给出，就不在这里给出了。可以在 <a target="_blank" rel="noopener" href="https://inivation.cn/?list=24">https://inivation.cn/?list=24</a> 下加微信咨询中国经销商。</li>
<li>双目版本就是两个单目相机通过支架连在一起。双目的价格是单目的2倍。</li>
</ol>
</blockquote>
<h2 id="售后">售后</h2>
<p>经销商给出的回答是：</p>
<ol>
<li>国内有工程师，使用问题可以咨询我们。</li>
<li>如果有深入问题，我们会联系国外工程师提供解答。</li>
</ol>
<h1 id="驱动安装及相机可视化">驱动安装及相机可视化</h1>
<p>实验室购进的两台DAVIS346 Color到了，可以先安装一下驱动来简单查看一下相机的可视化效果。</p>
<blockquote>
<p>如果相机可视化全是噪点，旋转下三个镜头试试，尤其是中间的光圈。</p>
</blockquote>
<blockquote>
<p>下述项目按需编译，可以先看自己要做的工作需要用到哪个项目。</p>
</blockquote>
<h2 id="支持文档">支持文档</h2>
<p><a target="_blank" rel="noopener" href="https://docs.inivation.com/">官方支持文档</a></p>
<ul>
<li>
<p>重点：</p>
<ul>
<li>
<p><a target="_blank" rel="noopener" href="https://docs.inivation.com/software/dv/index.html">DV</a> 是我们的主要软件解决方案，其设计宗旨是用户友好且易于使用。它由两个主要组件组成：</p>
<ul>
<li>
<p><a target="_blank" rel="noopener" href="https://docs.inivation.com/software/dv/gui/index.html">dv-gui</a>，允许用户轻松与我们的相机交互，处理和可视化他们的数据。</p>
</li>
<li>
<p><a target="_blank" rel="noopener" href="https://dv-runtime.inivation.com/master/index.html#dv-runtime">dv-runtime</a>，<a target="_blank" rel="noopener" href="https://docs.inivation.com/software/dv/gui/index.html">dv-gui</a> 的后端，负责所有处理逻辑。它通过 GUI 进行控制。</p>
</li>
</ul>
</li>
<li>
<p><a target="_blank" rel="noopener" href="https://docs.inivation.com/software/dv-processing.html">DV-Processing</a> 是一个用于通用处理算法的 C++/Python 库。</p>
</li>
<li>
<p><a target="_blank" rel="noopener" href="https://docs.inivation.com/software/other-software.html#dv-ros">dv-ros</a> 项目提供 iniVation 事件相机与 ROS 的集成。通过使用 DV-Processing 实现 ROS 节点来执行集成。 dv-ros 还提供了几种封装在 ROS 节点中的事件数据处理算法，可立即用于具有事件相机和 ROS 的计算机视觉应用程序。</p>
</li>
</ul>
</li>
<li>
<p>了解即可：</p>
<ul>
<li>
<p><a target="_blank" rel="noopener" href="https://dv-runtime.inivation.com/master/index.html#dv-runtime">dv-runtime</a> 是我们提供的运行时系统。它是托管模块并负责线程、内存分配和模块之间的数据交换的环境。</p>
</li>
<li>
<p><a target="_blank" rel="noopener" href="https://dv-sdk.inivation.com/master/index.html">dv-sdk</a> 是我们提供的库，用于扩展DV软件提供的功能或将其他算法集成到其中。它用于创建新模块，以实现新的处理功能或集成现有算法。</p>
</li>
</ul>
</li>
</ul>
<h2 id="dv-gui及USB驱动">dv-gui及USB驱动</h2>
<h3 id="安装">安装</h3>
<p>安装dv-gui：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># Bionic (18.04 LTS) on the x86_64, x86, arm64 and armhf architectures</span><br>sudo add-apt-repository ppa:ubuntu-toolchain-r/test<br>sudo add-apt-repository ppa:inivation-ppa/inivation-bionic<br>sudo apt-get update<br>sudo apt-get install dv-gui  <span class="hljs-comment"># 会同时安装dv-runtime</span><br><br><span class="hljs-comment"># Focal (20.04 LTS) and Jammy (22.04 LTS) on the x86_64, arm64 and armhf architectures</span><br>sudo add-apt-repository ppa:inivation-ppa/inivation<br>sudo apt-get update<br>sudo apt-get install dv-gui  <span class="hljs-comment"># 会同时安装dv-runtime</span><br></code></pre></td></tr></table></figure>
<p>如果您计划开发自己的模块，请安装以下附加软件包：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo apt-get install dv-runtime-dev<br></code></pre></td></tr></table></figure>
<p>在 ARM 上，你可能需要使用以下环境变量来启动 dv 运行时：<code>UNW_ARM_UNWIND_METHOD=4</code>。</p>
<p>安装libcaer：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo apt-get install libcaer-dev<br></code></pre></td></tr></table></figure>
<blockquote>
<p>我们的大多数设备都使用 USB 与主机系统通信。为了确保我们的软件可以识别它们并与它们交互，必须安装正确的驱动程序并授予正确的权限，具体取决于所使用的操作系统。</p>
<p>Linux 下对 USB 设备的访问是由标准内核 USB 驱动程序和 libusb 库提供的。必须正确配置运行我们软件的用户的权限才能访问设备。您必须授予用户对 USB 设备的访问权限。</p>
<p>必须安装适当的 udev 文件。我们的 Arch、Fedora、Ubuntu 和 Gentoo 的 libcaer 软件包已经自动提供了这些文件，并且从源代码编译的 libcaer 也会尝试将它们安装到 <code>/lib/udev/rules.d/</code> 的适当位置。</p>
<p>其它<a target="_blank" rel="noopener" href="https://docs.inivation.com/hardware/hardware-advanced-usage/usb-drivers.html">USB驱动安装方式</a>，略。</p>
</blockquote>
<blockquote>
<p>更新完成后，如果此时已经插着相机，拔下相机插头并将其重新插入计算机。</p>
</blockquote>
<h3 id="运行-可视化">运行/可视化</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">dv-gui  <span class="hljs-comment"># 或者在应用程序界面直接点击运行 DV</span><br></code></pre></td></tr></table></figure>
<p>运行<code>dv-gui</code>报错：Could not find a dv-runtime executable on the system. Is dv-runtime installed?</p>
<blockquote>
<p>怀疑是自己之前卸载过<code>dv-runtime</code>，但是没有卸载干净。系统以为还有<code>dv-runtime</code>。</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo find / -name *dv-gui* 2&gt;/dev/null  <span class="hljs-comment"># /usr/bin/dv-gui</span><br>sudo find / -name *dv-runtime* 2&gt;/dev/null  <span class="hljs-comment"># /usr/bin/dv-runtime</span><br><span class="hljs-comment"># 卸载重装</span><br>apt list --installed | grep -i dv-runtime  <span class="hljs-comment"># 模糊搜索</span><br>sudo apt remove dv-runtime  <span class="hljs-comment"># 卸载软件，会同时卸载掉dv-gui</span><br>sudo apt-get purge dv-runtime  <span class="hljs-comment"># 清除配置</span><br><span class="hljs-comment"># 然后重新安装dv-dui</span><br></code></pre></td></tr></table></figure>
<p>效果如下：</p>
<img src="/posts/9d7fd48f/dv-gui%E5%8F%AF%E8%A7%86%E5%8C%96.png" srcset="/img/loading.gif" lazyload class="" title="dv-gui可视化">
<h3 id="高级用法">高级用法</h3>
<p>详细的GUI界面介绍请见<a target="_blank" rel="noopener" href="https://docs.inivation.com/software/dv/gui/getting-started.html">Getting Started</a>，这里只列出几个个人认为重要的点。</p>
<ol>
<li>在 <code>DV</code> 的左侧，有 <code>Project Bar</code> ，您可以在其中选择现有或已保存的项目。这些项目是 <code>.xml</code> 文件，用于存储“输出”选项卡和“结构”选项卡的状态。</li>
<li>“DAVIS”实际上代表“动态和主动像素视觉传感器” - 换句话说，它是 DVS 和 APS 电路的融合，能够使用相同的光电二极管产生动态事件和拍照。“APS”代表“主动像素传感器”。这是标准 CMOS 图像传感器的术语，其中像素中的晶体管主动传输与曝光期间读取的光强度相关的值。</li>
<li><a target="_blank" rel="noopener" href="https://docs.inivation.com/software/dv/modules/index.html">DV Modules</a>：<code>DV</code> 中的 <code>modules</code> 是设计用于对某些数据执行特定操作的逻辑块。在<code>dv-gui</code>，点击中间上面的<code>Structure</code>选项，选中模块，点击上面的<code>Remove module</code>可以删除模块；点击<code>Add module</code>可以增加模块；使用鼠标可以在两个模块之间进行连线。</li>
<li><a href="#%E4%BD%BF%E7%94%A8dv-gui%E8%BF%9B%E8%A1%8C%E5%BD%95%E5%88%B6%E4%B8%8E%E5%9B%9E%E6%94%BE">录制与回放</a>。</li>
</ol>
<h2 id="rpg-dvs-ros">rpg_dvs_ros</h2>
<p><a target="_blank" rel="noopener" href="https://github.com/uzh-rpg/rpg_dvs_ros">项目地址</a></p>
<p>ROS DVS 包为动态视觉传感器 (DVS/DAVIS) 提供 C++ 驱动程序。即使您没有 DAVS 或 DAVIS 设备，您仍然可以使用此驱动程序读取预先记录的事件数据文件。该软件包还提供了用于固有校准和立体校准的校准工具。</p>
<h3 id="安装依赖项">安装依赖项</h3>
<ul>
<li>
<p>Eigen &gt;= 3.3.0</p>
<ul>
<li>
<p><a href="https://zeyulong.com/posts/5c3493c4/">Eigen的安装与版本管理</a></p>
</li>
<li>
<p>查看当前版本：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">gedit /usr/include/eigen3/Eigen/src/Core/util/Macros.h<br></code></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li>
<p>gcc/g++ &gt;= 5.5.0</p>
<ul>
<li>
<p><a href="https://zeyulong.com/posts/6dba0521/">gcc、g++的安装与版本管理</a></p>
</li>
<li>
<p>查看当前版本：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">gcc -v<br>g++ -v<br></code></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li>
<p>OpenCV &gt;= 3.2.0</p>
<ul>
<li>
<p><a href="https://zeyulong.com/posts/75ff45ce/">OpenCV的安装与版本管理</a></p>
</li>
<li>
<p>查看当前版本：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">pkg-config --modversion opencv  <span class="hljs-comment"># 查询版本</span><br>pkg-config --cflags opencv  <span class="hljs-comment"># 得到opencv的安装路径</span><br><span class="hljs-comment"># -&gt; -I/usr/local/include/opencv -I/usr/local/include</span><br>pkg-config --cflags opencv4  <span class="hljs-comment"># 附加：得到opencv4的安装路径</span><br></code></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h3 id="DV软件库">DV软件库</h3>
<p><a href="https://zeyulong.com/posts/84f91530/">ROS的安装与卸载</a></p>
<blockquote>
<p>将下面提到的ROS版本替换为你自己的版本。</p>
</blockquote>
<ol>
<li>
<p>安装ROS依赖项：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># melodic/kinetic/Noetic</span><br>sudo apt-get install ros-melodic-camera-info-manager<br>sudo apt-get install ros-melodic-image-view<br></code></pre></td></tr></table></figure>
</li>
<li>
<p>安装libcaer。</p>
<ol>
<li>
<p>首先根据下面的网站<a target="_blank" rel="noopener" href="https://inivation.gitlab.io/dv/dv-docs/docs/getting-started.html#ubuntu-linux">iniVation documentation</a>添加存储库：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># Bionic (18.04 LTS) on the x86_64, x86, arm64 and armhf architectures</span><br>sudo add-apt-repository ppa:ubuntu-toolchain-r/test<br>sudo add-apt-repository ppa:inivation-ppa/inivation-bionic<br>sudo apt-get update<br>sudo apt-get install dv-gui<br><br><span class="hljs-comment"># Focal (20.04 LTS) and Jammy (22.04 LTS) on the x86_64, arm64 and armhf architectures</span><br>sudo add-apt-repository ppa:inivation-ppa/inivation<br>sudo apt-get update<br>sudo apt-get install dv-gui<br></code></pre></td></tr></table></figure>
<p>如果您计划开发自己的模块，请安装以下附加软件包：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo apt-get install dv-runtime-dev<br></code></pre></td></tr></table></figure>
<p>在 ARM 上，你可能需要使用以下环境变量来启动 dv 运行时：<code>UNW_ARM_UNWIND_METHOD=4</code>。</p>
</li>
<li>
<p>安装libcaer：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo apt-get install libcaer-dev<br></code></pre></td></tr></table></figure>
</li>
</ol>
</li>
<li>
<p>安装catkin tools：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo apt-get install python-catkin-tools<br></code></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="ROS编译">ROS编译</h3>
<p><a href="https://zeyulong.com/posts/84f91530/">ROS的安装与卸载</a></p>
<ol>
<li>
<p>创建一个catkin工作区：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> yourfolder<br><span class="hljs-built_in">mkdir</span> -p catkin_ws/src<br><span class="hljs-built_in">cd</span> catkin_ws<br>catkin config --init --mkdirs --extend /opt/ros/melodic --merge-devel --cmake-args -DCMAKE_BUILD_TYPE=Release<br><br><span class="hljs-built_in">cd</span> catkin_ws/src<br>catkin_init_workspace<br><span class="hljs-built_in">cd</span> ..<br>catkin build<br></code></pre></td></tr></table></figure>
</li>
<li>
<p>克隆<a target="_blank" rel="noopener" href="https://github.com/catkin/catkin_simple">catkin_simple包</a>，它将用于构建 DVS/DAVIS 驱动程序包：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> yourfolder/catkin_ws/src<br>git <span class="hljs-built_in">clone</span> https://github.com/catkin/catkin_simple.git<br></code></pre></td></tr></table></figure>
</li>
<li>
<p>克隆 rpg_dvs_ros 的存储库：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> yourfolder/catkin_ws/src<br>git <span class="hljs-built_in">clone</span> https://github.com/uzh-rpg/rpg_dvs_ros.git<br></code></pre></td></tr></table></figure>
</li>
<li>
<p>（可选）指定项目编译使用的OpenCV版本。在项目中所有<code>CMakeLists.txt</code>文件出现指定OpenCV的地方：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs cmake"><span class="hljs-keyword">set</span>(OpenCV_DIR /usr/local/opencv/opencv345/share/OpenCV)  <span class="hljs-comment"># 新增</span><br><span class="hljs-keyword">find_package</span>(OpenCV REQUIRED)<br><span class="hljs-comment"># find_package(cv_bridge)  # 如果find_package(OpenCV REQUIRED)报错</span><br><span class="hljs-keyword">include_directories</span>(<span class="hljs-variable">$&#123;OpenCV_INCLUDE_DIRS&#125;</span>)  <span class="hljs-comment"># 新增</span><br><span class="hljs-comment"># 新增</span><br><span class="hljs-keyword">message</span>(STATUS <span class="hljs-string">&quot;opencv version: $&#123;OpenCV_VERSION&#125;&quot;</span>)<br><span class="hljs-keyword">message</span>(STATUS <span class="hljs-string">&quot;opencv lib: $&#123;OpenCV_LIBS&#125;&quot;</span>)<br><span class="hljs-keyword">message</span>(STATUS <span class="hljs-string">&quot;opencv include dir: $&#123;OpenCV_INCLUDE_DIRS&#125;&quot;</span>)<br><span class="hljs-keyword">message</span>(STATUS <span class="hljs-string">&quot;opencv config path: $&#123;openCV_CONFIG_PATH&#125;&quot;</span>)<br></code></pre></td></tr></table></figure>
</li>
<li>
<p>编译驱动器：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> yourfolder/catkin_ws<br>catkin build dvs_ros_driver  <span class="hljs-comment"># if you are using the DVS128</span><br>catkin build davis_ros_driver  <span class="hljs-comment"># if you are using the DAVIS</span><br>catkin build dvxplorer_ros_driver  <span class="hljs-comment"># if you are using the DVXplorercd yourfolder/catkin_ws</span><br><span class="hljs-comment"># 编译完成后，在代码运行前，须使用source命令刷新一下工作空间的环境。否则会出现找不到“package XXX not found” 的问题。</span><br><span class="hljs-built_in">source</span> ./catkin_ws/devel/setup.bash<br></code></pre></td></tr></table></figure>
<blockquote>
<p>如果编译报错：<code>catkin clean</code>相当于<code>rm -r $&#123;build&#125; $&#123;devel&#125;</code>，但是避免了<code>rm -r</code>这种危险的操作！</p>
</blockquote>
</li>
<li>
<p>编译渲染器：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> yourfolder/catkin_ws<br>catkin build dvs_renderer<br><span class="hljs-comment"># 编译完成后，在代码运行前，须使用source命令刷新一下工作空间的环境。否则会出现找不到“package XXX not found” 的问题。</span><br><span class="hljs-built_in">source</span> ./devel/setup.bash<br></code></pre></td></tr></table></figure>
<blockquote>
<p>如果OpenCV报错，可以尝试对照<a href="https://zeyulong.com/posts/75ff45ce/">OpenCV的安装与版本管理</a>更换版本管理方法。</p>
</blockquote>
</li>
<li>
<p>添加环境变量（可选）。</p>
<p>代码编译完成，后面需要运行ros命令，为了避免每次打开新的shell都需要source，我们将其添加到bash配置文件中。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 方法一，使用gedit</span><br><span class="hljs-built_in">echo</span> “<span class="hljs-built_in">source</span> youfolder/catkin_ws/devel/setup.bash” &gt;&gt; ~/.bashrc<br>gedit ~/.bashrc  <span class="hljs-comment"># 注：用gedit打开文件，查看是否加入</span><br><br><span class="hljs-comment"># 方法二，使用vim</span><br>sudo  vi ~/.bashrc  <span class="hljs-comment"># 注：打开.bashrc文件</span><br><span class="hljs-comment"># 最后一行添加：</span><br><span class="hljs-built_in">source</span> youfolder/catkin_ws/devel/setup.bash	<br><span class="hljs-comment"># 注：点击键盘“E”，进入编辑（edit）模式，用“delete”键删除添加的路径</span><br></code></pre></td></tr></table></figure>
<p>注，vim按键：</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs txt">按Esc。输入 :wq！，保存并退出。<br>注：ESC”键退出编辑模式，并输入以下命令：<br>:wq 保存后退出vi，若为:wq!则为强制存储后退出<br>:w    保存但不退出<br>:w!   若文件属性为【只读】，强制写入该档案<br>:q     离开vi<br>:q!    若曾经修改过档案，又不想存储，使用！为强制离开不存储档案<br>:e!    将档案还原到最原始状态！<br></code></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="验证编译-可视化">验证编译/可视化</h3>
<p>您可以通过运行提供的启动文件来测试安装。它启动驱动程序(DVS 或 DAVIS)和渲染器(图像查看器)。</p>
<ul>
<li>
<p>启动实机：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> yourfolder/catkin_ws<br><span class="hljs-built_in">source</span> ./devel/setup.bash &amp;&amp; roslaunch dvs_renderer dvs_mono.launch  <span class="hljs-comment"># if you are using the DVS128</span><br><br><span class="hljs-built_in">source</span> ./devel/setup.bash &amp;&amp; roslaunch dvs_renderer davis_mono.launch  <span class="hljs-comment"># if you are using the DAVIS</span><br><span class="hljs-built_in">source</span> ./devel/setup.bash &amp;&amp; roslaunch dvs_renderer davis_color.launch<br><br><span class="hljs-built_in">source</span> ./devel/setup.bash &amp;&amp; roslaunch dvs_renderer dvxplorer_mono.launch  <span class="hljs-comment"># if you are using the DVXplorer</span><br></code></pre></td></tr></table></figure>
<p>得到实时可视化结果。效果如下：</p>
<img src="/posts/9d7fd48f/rpg_dvs_ros%E5%8F%AF%E8%A7%86%E5%8C%96.png" srcset="/img/loading.gif" lazyload class="" title="rpg_dvs_ros可视化">
<blockquote>
<p>勾选参数配置界面的“autoexposure_enabled”以开启自动曝光，否则场景太亮的光源图像帧会可视化不到其它东西。</p>
</blockquote>
</li>
<li>
<p>如果您没有 <mark>DAVIS</mark>，您仍然可以使用此驱动程序读取记录的文件。示例：</p>
<ol>
<li>
<p>下载数据集的序列，如<a target="_blank" rel="noopener" href="http://rpg.ifi.uzh.ch/datasets/davis/slider_depth.bag">slider_deep.bag</a>。</p>
</li>
<li>
<p>打开第一个终端，启动roscore：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">roscore<br></code></pre></td></tr></table></figure>
</li>
<li>
<p>在第二个终端，播放bag包：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">rosbag play -l path-to-file/slider_depth.bag<br></code></pre></td></tr></table></figure>
<blockquote>
<p>报错：/opt/ros/melodic/lib/rosbag/play: error while loading shared libraries: <a target="_blank" rel="noopener" href="http://librosbag.so">librosbag.so</a>: cannot open shared object file: No such file or directory</p>
<p>解决：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo gedit ~/.zshrc<br><span class="hljs-built_in">export</span> LD_LIBRARY_PATH=<span class="hljs-variable">$LD_LIBRARY_PATH</span>:/opt/ros/melodic/lib<br></code></pre></td></tr></table></figure>
</blockquote>
</li>
<li>
<p>在第三个终端中，启动 DVS/DAVIS 渲染器：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">source</span> ./devel/setup.zsh &amp;&amp; roslaunch dvs_renderer renderer_mono.launch<br><span class="hljs-comment"># 如果没有刷新环境变量，会报错 RLException: [xx.launch] is neither a launch file in package [x] nor is [x] a launch file name</span><br></code></pre></td></tr></table></figure>
<blockquote>
<p>如果要播放其他的rosbag数据集<code>.bag</code>文件，注意提前使用<code>rosbag info BagFileName.bag</code>命令，查看<code>.bag</code>文件的<code>topics</code>，修改<code>./catkin_ws/src/rpg_dvs_ros/dvs_renderer/launch</code>文件夹里，<code>.launch</code>文件里，<code>events</code>、<code>image</code>等参数指向的路径。</p>
</blockquote>
</li>
<li>
<p>你可以看到连续图像的播放。</p>
</li>
</ol>
</li>
</ul>
<h3 id="参数配置">参数配置</h3>
<p>对于来自 DAVIS 的实时数据流(即，不是记录的文件) ，您可以使用动态重新配置 GUI 根据需要调整 DVS/DAVIS 参数。运行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 第一个终端</span><br>roscore<br><span class="hljs-comment"># 第二个终端</span><br><span class="hljs-built_in">source</span> ./devel/setup.zsh &amp;&amp; rosrun rqt_reconfigure rqt_reconfigure<br></code></pre></td></tr></table></figure>
<p>一个窗口将会出现。选择 <code>davis_ros_Driver</code>（在左侧面板中），您应该会得到 GUI，它允许您修改传感器的参数。</p>
<blockquote>
<p>其实在<code>roslaunch dvs_renderer renderer_mono.launch</code>时会自动打开该参数配置界面。</p>
</blockquote>
<h2 id="dv-ros">dv-ros</h2>
<p><a target="_blank" rel="noopener" href="https://gitlab.com/inivation/dv/dv-ros">项目地址</a></p>
<p>用于 iniVation 相机和 DV 软件基础设施的 ROS 驱动程序和示例节点。</p>
<h3 id="兼容性">兼容性</h3>
<p>事件的消息类型被设计为与 <a target="_blank" rel="noopener" href="https://github.com/uzh-rpg/rpg_dvs_ros">rpg_dvs_ros</a> 存储库中可用的类型兼容，因此可以与使用这些事件消息类型（Event 和 EventArray）开发的所有节点进行通信。 <code>capture_node</code> 被设计为一个更通用的节点，替换每种类型的 iniVation 相机的各个节点（ <code>davis_ros_driver</code> 、 <code>dvs_ros_driver</code> 和 <code>dvxplorer_ros_driver</code> ）。</p>
<h3 id="存储库结构">存储库结构</h3>
<p>该存储库包含多个项目：</p>
<ul>
<li><code>dv_ros_msgs</code> - 相机的基本数据类型</li>
<li><code>dv_ros_messaging</code> - 在 ROS 节点中使用 dv-processing 所需的 C++ 标头</li>
<li><code>dv_ros_capture</code> - 相机驱动程序节点（支持实时相机数据流和 aedat4 文件播放）</li>
<li><mark><code>dv_ros_accumulation</code></mark> - 事件流到帧累积</li>
<li><code>dv_ros_aedat4</code> - 将 aedat4 文件转换为 rosbags</li>
<li><code>dv_ros_runtime_modules</code> - 用于与 ROS 集成的 DV 运行时模块</li>
<li><mark><code>dv_ros_visualization</code></mark> - 事件的简单可视化</li>
<li><mark><code>dv_ros_tracker</code></mark>- 用于事件和图像流的 Lucas-Kanade 特征跟踪器（包含运动补偿）</li>
</ul>
<h3 id="安装依赖项-2">安装依赖项</h3>
<ul>
<li>
<p>Eigen &gt;= 3.4.0</p>
<ul>
<li>
<p><a href="https://zeyulong.com/posts/5c3493c4/">Eigen的安装与版本管理</a></p>
</li>
<li>
<p>查看当前版本：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">gedit /usr/include/eigen3/Eigen/src/Core/util/Macros.h<br></code></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li>
<p>gcc/g++ &gt;= 10.0.0</p>
<ul>
<li>
<p><a href="https://zeyulong.com/posts/6dba0521/">gcc、g++的安装与版本管理</a></p>
</li>
<li>
<p>查看当前版本：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">gcc -v<br>g++ -v<br></code></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li>
<p>OpenCV &gt;= 4.2.0</p>
<ul>
<li>
<p><a href="https://zeyulong.com/posts/75ff45ce/">OpenCV的安装与版本管理</a></p>
<blockquote>
<p>这里不需要把系统指定的OpenCV的版本指定为4.2.0及以上的版本，可以保持OpenCV3的版本。只要保证将OpenCV4安装好就可以了，后续可以在编译dv-ros时指定其使用到的OpenCV版本（路径）。</p>
</blockquote>
</li>
<li>
<p>查看当前版本：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">pkg-config --modversion opencv  <span class="hljs-comment"># 查询版本</span><br>pkg-config --cflags opencv  <span class="hljs-comment"># 得到opencv的安装路径</span><br><span class="hljs-comment"># -&gt; -I/usr/local/include/opencv -I/usr/local/include</span><br>pkg-config --cflags opencv4  <span class="hljs-comment"># 附加：得到opencv4的安装路径</span><br></code></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h3 id="DV软件库-2">DV软件库</h3>
<p>该代码依赖于DV软件库，需要安装这些库以便ROS节点进行编译。根据您的 Ubuntu 发行版启用适当的 iniVation PPA：</p>
<ul>
<li>
<p>Ubuntu 18.04:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo add-apt-repository ppa:ubuntu-toolchain-r/test<br>sudo add-apt-repository ppa:inivation-ppa/inivation-bionic<br>sudo apt update<br>sudo apt install dv-processing dv-runtime-dev gcc-10 g++-10<br></code></pre></td></tr></table></figure>
</li>
<li>
<p>Ubuntu 20.04:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo add-apt-repository ppa:inivation-ppa/inivation<br>sudo apt update<br>sudo apt install dv-processing dv-runtime-dev gcc-10 g++-10<br></code></pre></td></tr></table></figure>
</li>
</ul>
<blockquote>
<p>如果之前手动在Linux系统中编译安装过源文件，例如<code>dv-runtime-1.2.5</code>，要先卸载掉再安装新版：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> dv-runtime-1.2.5/build<br><span class="hljs-built_in">cat</span> install_manifest.txt | sudo xargs <span class="hljs-built_in">rm</span>  <span class="hljs-comment"># 删除掉安装在系统中的文件</span><br>sudo make uninstall<br>sudo make clean  <span class="hljs-comment"># 清除上一次make命令生成的文件</span><br>sudo make distclean  <span class="hljs-comment"># 清除上一次make以及configure命令生成的文件</span><br>sudo <span class="hljs-built_in">rm</span> -r build<br></code></pre></td></tr></table></figure>
</blockquote>
<p>可能还需要一些额外的 ROS 依赖项：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># Example for ROS Noetic on Ubuntu 18.04</span><br>sudo apt install python3-catkin python3-catkin-tools ros-melodic-catkin ros-melodic-camera-info-manager<br><span class="hljs-comment"># Example for ROS Noetic on Ubuntu 20.04</span><br>sudo apt install python3-catkin python3-catkin-tools ros-noetic-catkin ros-noetic-camera-info-manager<br></code></pre></td></tr></table></figure>
<h3 id="ROS编译-2">ROS编译</h3>
<p><a href="https://zeyulong.com/posts/84f91530/">ROS的安装与卸载</a></p>
<ol>
<li>
<p>新建工作区：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> youfolder/<br><span class="hljs-built_in">mkdir</span> -p catkin_ws/src  <span class="hljs-comment"># catkin_ws可改名</span><br><br><span class="hljs-built_in">cd</span> catkin_ws<br>catkin config --init --mkdirs --extend /opt/ros/melodic --merge-devel --cmake-args -DCMAKE_BUILD_TYPE=Release<br><br><span class="hljs-built_in">cd</span> src<br>catkin_init_workspace  <span class="hljs-comment"># 创建顶层CMakeLists.txt文件，CLion利用此文件打开项目</span><br><br><span class="hljs-built_in">cd</span> ..<br>catkin build  <span class="hljs-comment"># 编译生成完整工作区</span><br></code></pre></td></tr></table></figure>
<p>此时，<code>./catkin_ws</code>文件夹下有<code>build</code>、<code>devel</code>、<code>logs</code>和<code>src</code>四个文件夹。</p>
</li>
<li>
<p>下载代码：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> src<br><span class="hljs-comment"># 把代码总放在src文件夹下</span><br>git <span class="hljs-built_in">clone</span> https://gitlab.com/inivation/dv/dv-ros.git<br></code></pre></td></tr></table></figure>
</li>
<li>
<p>下载第三方库：</p>
<ol>
<li>下载<a target="_blank" rel="noopener" href="https://github.com/CLIUtils/CLI11/tree/10f3ab90251623a4d74dc347fc5dd82c01a946d1">CLI11 @ 10f3ab90</a>到<code>./catkin_ws/src/dv-ros-master/dv_ros_aedat4/thirdparty</code>解压并重命名为<code>CLI11</code>。</li>
</ol>
</li>
<li>
<p>（可选）把<code>dv-ros/dv_ros_aedat4/src/convert_aedat4.cpp</code>中第43行改为：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">// app.add_flag(&quot;-n,--namespace&quot;, topicNamespace, &quot;Topic namespace&quot;);</span><br>app.<span class="hljs-built_in">add_option</span>(<span class="hljs-string">&quot;-n,--namespace&quot;</span>, topicNamespace, <span class="hljs-string">&quot;Topic namespace&quot;</span>);<br></code></pre></td></tr></table></figure>
<p><code>-n</code>参数应该读入的是字符串，而不是一个标志。这在使用该功能包<code>convert_aedat4</code>将<code>*.aedat4</code>格式转换为<code>*.bag</code>格式时会用到。</p>
</li>
<li>
<p>（可选）指定项目编译使用的OpenCV版本。在项目中所有<code>CMakeLists.txt</code>文件出现指定OpenCV的地方：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs cmake"><span class="hljs-keyword">set</span>(OpenCV_DIR /usr/local/opencv/opencv452/share/OpenCV)  <span class="hljs-comment"># 新增</span><br><span class="hljs-keyword">find_package</span>(OpenCV REQUIRED)<br><span class="hljs-comment"># find_package(cv_bridge)  # 如果find_package(OpenCV REQUIRED)报错</span><br><span class="hljs-keyword">include_directories</span>(<span class="hljs-variable">$&#123;OpenCV_INCLUDE_DIRS&#125;</span>)  <span class="hljs-comment"># 新增</span><br><span class="hljs-comment"># 新增</span><br><span class="hljs-keyword">message</span>(STATUS <span class="hljs-string">&quot;opencv version: $&#123;OpenCV_VERSION&#125;&quot;</span>)<br><span class="hljs-keyword">message</span>(STATUS <span class="hljs-string">&quot;opencv lib: $&#123;OpenCV_LIBS&#125;&quot;</span>)<br><span class="hljs-keyword">message</span>(STATUS <span class="hljs-string">&quot;opencv include dir: $&#123;OpenCV_INCLUDE_DIRS&#125;&quot;</span>)<br><span class="hljs-keyword">message</span>(STATUS <span class="hljs-string">&quot;opencv config path: $&#123;openCV_CONFIG_PATH&#125;&quot;</span>)<br></code></pre></td></tr></table></figure>
</li>
<li>
<p>编译代码：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> ../  <span class="hljs-comment"># 退回到catkin_ws文件夹</span><br><span class="hljs-comment"># catkin build dv_ros_accumulation dv_ros_capture dv_ros_imu_bias dv_ros_messaging dv_ros_runtime_modules dv_ros_tracker dv_ros_visualization -DCMAKE_BUILD_TYPE=Release --cmake-args -DCMAKE_C_COMPILER=gcc-10 -DCMAKE_CXX_COMPILER=g++-10</span><br>catkin build -DCMAKE_BUILD_TYPE=Release --cmake-args -DCMAKE_C_COMPILER=gcc-10 -DCMAKE_CXX_COMPILER=g++-10  <span class="hljs-comment"># 或 catkin_make。相当于cmake+make</span><br><span class="hljs-comment"># 编译完成后，在代码运行前，须使用source命令刷新一下工作空间的环境。否则会出现找不到“package XXX not found” 的问题。</span><br><span class="hljs-built_in">source</span> ./catkin_ws/devel/setup.bash<br></code></pre></td></tr></table></figure>
<blockquote>
<p>加速编译：</p>
<ol>
<li>
<p><code>catkin build</code>命令会自动执行多线程，使用最快的编译速度。</p>
</li>
<li>
<p><code>catkin_make -j2 -l2</code> :</p>
<ul>
<li>-j2，j 是 job 的意思，代表允许 2 个编译命令同时进行，一般是以 CPU的核心数目的两倍为。</li>
<li>-l2，l 是 load-average 的意思，代表系统加载的任务数，数目一般与-j的数目保持一致。</li>
</ul>
<p>注意，此处不仅限于2，可以是2，4，8，这取决于你是几核CPU。</p>
</li>
</ol>
</blockquote>
<blockquote>
<p>如果编译报错：<code>catkin clean</code>相当于<code>rm -r $&#123;build&#125; $&#123;devel&#125;</code>，但是避免了<code>rm -r</code>这种危险的操作！</p>
</blockquote>
<p>报错：</p>
<ol>
<li>
<p>CMake Error at /usr/lib/x86_64-linux-gnu/cmake/dv-processing/dv-processing-config.cmake:40 (MESSAGE): Cannot find OpenCV 4.2.0 or newer.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo gedit /usr/lib/x86_64-linux-gnu/cmake/dv-processing/dv-processing-config.cmake<br><span class="hljs-comment"># Line 38</span><br>SET(OpenCV_DIR /usr/local/opencv/opencv452/lib/cmake/opencv4)<br></code></pre></td></tr></table></figure>
</li>
<li>
<p>error: ‘Vector3’ in namespace ‘Eigen’ does not name a template type; did you mean ‘Vector3d’?</p>
<p>使用Eigen &gt;= 3.4.0，3.3.0版本不行。就算将<code>Eigen::Vector3&lt;double&gt;</code>改为<code>Eigen::Vector3d</code>也不能根治，后面还会有其他牵连到的报错。使用Eigen 3.4.0 一劳永逸。</p>
</li>
</ol>
</li>
<li>
<p>添加环境变量（可选）。</p>
<p>代码编译完成，后面需要运行ros命令，为了避免每次打开新的shell都需要source，我们将其添加到bash配置文件中。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 方法一，使用gedit</span><br><span class="hljs-built_in">echo</span> “<span class="hljs-built_in">source</span> youfolder/catkin_ws/devel/setup.bash” &gt;&gt; ~/.bashrc<br>gedit ~/.bashrc  <span class="hljs-comment"># 注：用gedit打开文件，查看是否加入</span><br><br><span class="hljs-comment"># 方法二，使用vim</span><br>sudo  vi ~/.bashrc  <span class="hljs-comment"># 注：打开.bashrc文件</span><br><span class="hljs-comment"># 最后一行添加：</span><br><span class="hljs-built_in">source</span> youfolder/catkin_ws/devel/setup.bash	<br><span class="hljs-comment"># 注：点击键盘“E”，进入编辑（edit）模式，用“delete”键删除添加的路径</span><br></code></pre></td></tr></table></figure>
<p>注，vim按键：</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs txt">按Esc。输入 :wq！，保存并退出。<br>注：ESC”键退出编辑模式，并输入以下命令：<br>:wq 保存后退出vi，若为:wq!则为强制存储后退出<br>:w    保存但不退出<br>:w!   若文件属性为【只读】，强制写入该档案<br>:q     离开vi<br>:q!    若曾经修改过档案，又不想存储，使用！为强制离开不存储档案<br>:e!    将档案还原到最原始状态！<br></code></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="验证编译-可视化-2">验证编译/可视化</h3>
<p>编译后，获取您的环境以加载有关新包的信息，将相机连接到计算机并通过运行可视化示例来验证编译：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">source</span> ./devel/setup.zsh &amp;&amp; roslaunch dv_ros_visualization event_visualization.launch<br></code></pre></td></tr></table></figure>
<p>您应该会看到来自连接到计算机的 iniVation 摄像头的事件预览。效果如下：</p>
<img src="/posts/9d7fd48f/dv-ros%E5%8F%AF%E8%A7%86%E5%8C%96.png" srcset="/img/loading.gif" lazyload class="" title="dv-ros可视化">
<h2 id="imu-utils">imu_utils</h2>
<p><a target="_blank" rel="noopener" href="https://github.com/gaowenliang/imu_utils">项目地址</a></p>
<p>该项目是用于标定IMU，用于分析IMU性能的ROS封装工具。</p>
<h3 id="安装依赖项-3">安装依赖项</h3>
<ul>
<li>
<p>Eigen &gt;= 3.3.0</p>
<ul>
<li>
<p><a href="https://zeyulong.com/posts/5c3493c4/">Eigen的安装与版本管理</a></p>
</li>
<li>
<p>查看当前版本：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">gedit /usr/include/eigen3/Eigen/src/Core/util/Macros.h<br></code></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li>
<p>gcc/g++ &gt;= 5.5.0</p>
<ul>
<li>
<p><a href="https://zeyulong.com/posts/6dba0521/">gcc、g++的安装与版本管理</a></p>
</li>
<li>
<p>查看当前版本：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">gcc -v<br>g++ -v<br></code></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li>
<p>Ceres-Solver == 1.14</p>
<ul>
<li><a href="https://zeyulong.com/posts/60c04195/">Ceres-Solver的安装与卸载</a></li>
</ul>
</li>
<li>
<p>OpenCV &gt;= 3.2.0</p>
<ul>
<li>
<p><a href="https://zeyulong.com/posts/75ff45ce/">OpenCV的安装与版本管理</a></p>
</li>
<li>
<p>查看当前版本：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">pkg-config --modversion opencv  <span class="hljs-comment"># 查询版本</span><br>pkg-config --cflags opencv  <span class="hljs-comment"># 得到opencv的安装路径</span><br><span class="hljs-comment"># -&gt; -I/usr/local/include/opencv -I/usr/local/include</span><br>pkg-config --cflags opencv4  <span class="hljs-comment"># 附加：得到opencv4的安装路径</span><br></code></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h3 id="ROS编译-3">ROS编译</h3>
<ol>
<li>
<p>安装依赖项：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo apt-get install libdw-dev<br></code></pre></td></tr></table></figure>
</li>
<li>
<p>创建catkin工作区并克隆项目：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 首先我们可以创建一个工作区。</span><br><span class="hljs-built_in">cd</span> yourfloder<br><span class="hljs-built_in">mkdir</span> -p catkin_ws/src<br><span class="hljs-built_in">cd</span> catkin_ws<br><span class="hljs-built_in">source</span> /opt/ros/melodic/setup.bash  <span class="hljs-comment"># kinetic=16.04, melodic=18.04, noetic=20.04</span><br>catkin init<br>catkin config --extend /opt/ros/melodic<br>catkin config --merge-devel <span class="hljs-comment"># Necessary for catkin_tools &gt;= 0.4.</span><br>catkin config --cmake-args -DCMAKE_BUILD_TYPE=Release  <span class="hljs-comment"># 将其配置为以发布模式构建非常重要，否则优化将会很慢。</span><br><span class="hljs-comment"># 然后我们可以克隆该项目：</span><br><span class="hljs-built_in">cd</span> src<br>git <span class="hljs-built_in">clone</span> https://github.com/gaowenliang/code_utils.git<br>git <span class="hljs-built_in">clone</span> https://github.com/gaowenliang/imu_utils.git<br></code></pre></td></tr></table></figure>
</li>
<li>
<p>（可选）指定项目编译使用的OpenCV版本。在项目中所有<code>CMakeLists.txt</code>文件出现指定OpenCV的地方：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs cmake"><span class="hljs-keyword">set</span>(OpenCV_DIR /usr/local/opencv/opencv345/share/OpenCV)  <span class="hljs-comment"># 新增</span><br><span class="hljs-keyword">find_package</span>(OpenCV REQUIRED)<br><span class="hljs-comment"># find_package(cv_bridge)  # 如果find_package(OpenCV REQUIRED)报错</span><br><span class="hljs-keyword">include_directories</span>(<span class="hljs-variable">$&#123;OpenCV_INCLUDE_DIRS&#125;</span>)  <span class="hljs-comment"># 新增</span><br><span class="hljs-comment"># 新增</span><br><span class="hljs-keyword">message</span>(STATUS <span class="hljs-string">&quot;opencv version: $&#123;OpenCV_VERSION&#125;&quot;</span>)<br><span class="hljs-keyword">message</span>(STATUS <span class="hljs-string">&quot;opencv lib: $&#123;OpenCV_LIBS&#125;&quot;</span>)<br><span class="hljs-keyword">message</span>(STATUS <span class="hljs-string">&quot;opencv include dir: $&#123;OpenCV_INCLUDE_DIRS&#125;&quot;</span>)<br><span class="hljs-keyword">message</span>(STATUS <span class="hljs-string">&quot;opencv config path: $&#123;openCV_CONFIG_PATH&#125;&quot;</span>)<br></code></pre></td></tr></table></figure>
</li>
<li>
<p>使用<em>Release</em>配置构建代码。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> yourfloder/catkin_ws/<br><span class="hljs-comment"># 不能直接使用 catkin build 同时编译 code_utils 和 imu_utils</span><br><span class="hljs-comment"># imu_utils 会报错找不到 code_utils</span><br>catkin build code_utils -DCMAKE_BUILD_TYPE=Release<br>catkin build imu_utils -DCMAKE_BUILD_TYPE=Release<br></code></pre></td></tr></table></figure>
<blockquote>
<p>如果编译报错：<code>catkin clean</code>相当于<code>rm -r $&#123;build&#125; $&#123;devel&#125;</code>，但是避免了<code>rm -r</code>这种危险的操作！</p>
</blockquote>
<p>报错：</p>
<ol>
<li>
<p><code>code_utils/src/sumpixel_test.cpp</code>报错<code>backward.hpp</code>没有找到</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">// code_utils/src/sumpixel_test.cpp</span><br><br><span class="hljs-comment">// #include &quot;backward.hpp&quot;</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;code_utils/backward.hpp&quot;</span></span><br></code></pre></td></tr></table></figure>
</li>
<li></li>
</ol>
</li>
<li>
<p>构建完成后，刷新环境：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> yourfloder/catkin_ws/<br><span class="hljs-built_in">source</span> ./devel/setup.bash<br></code></pre></td></tr></table></figure>
</li>
<li></li>
</ol>
<h2 id="Kalibr">Kalibr</h2>
<blockquote>
<p>编译Kalibr主要是为了后面标定相机内参和视觉惯性联合标定。</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/ethz-asl/kalibr">项目地址</a></p>
<p>Kalibr 是一个解决以下校准问题的工具箱：</p>
<ul>
<li>多相机校准：具有非全局共享重叠视场的相机系统的内在和外在校准，支持多种<a target="_blank" rel="noopener" href="https://github.com/ethz-asl/kalibr/wiki/supported-models">相机型号</a>。</li>
<li>视觉惯性校准 (CAM-IMU)：IMU 与相机系统以及 IMU 内在参数的空间和时间校准。</li>
<li>多惯性校准 (IMU-IMU)：使用基础惯性传感器以及 IMU 内在参数对 IMU 进行空间和时间校准（需要 1 个辅助相机传感器）。</li>
<li>卷帘快门相机校准：卷帘快门相机的全面内在校准（投影、失真和快门参数）。</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://github.com/ethz-asl/kalibr/wiki">官方安装和使用教程</a></p>
<h3 id="使用Docker镜像">使用Docker镜像</h3>
<p>略。<a target="_blank" rel="noopener" href="https://github.com/ethz-asl/kalibr/wiki/installation">官方文档</a>。</p>
<h3 id="ROS编译-4">ROS编译</h3>
<ul>
<li><a target="_blank" rel="noopener" href="http://wiki.ros.org/kinetic/Installation/Ubuntu">Ubuntu 16.04 ROS 1 Kinetic</a> (uses OpenCV 3.3)</li>
<li><a target="_blank" rel="noopener" href="http://wiki.ros.org/melodic/Installation/Ubuntu">Ubuntu 18.04 ROS 1 Melodic</a> (uses OpenCV 3.2)</li>
<li><a target="_blank" rel="noopener" href="http://wiki.ros.org/noetic/Installation/Ubuntu">Ubuntu 20.04 ROS 1 Noetic</a> (uses OpenCV 4.2)</li>
</ul>
<p><a href="https://zeyulong.com/posts/84f91530/">ROS的安装与卸载</a></p>
<p><a href="https://zeyulong.com/posts/75ff45ce/">OpenCV的安装与版本管理</a></p>
<ol>
<li>
<p>安装依赖项：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 安装 catkin 工具</span><br>sudo apt-get install python-catkin-tools  <span class="hljs-comment"># ubuntu 16.04, 18.04</span><br>sudo apt-get install python3-catkin-tools python3-osrf-pycommon  <span class="hljs-comment"># ubuntu 20.04</span><br><br><span class="hljs-comment"># 所有 Ubuntu 版本的通用要求如下</span><br>sudo apt-get install -y \<br>    git wget autoconf automake nano \<br>    libeigen3-dev libboost-all-dev libsuitesparse-dev \<br>    doxygen libopencv-dev \<br>    libpoco-dev libtbb-dev libblas-dev liblapack-dev libv4l-dev<br><br><span class="hljs-comment"># 然后由于Python版本不同，需要安装以下内容：</span><br><span class="hljs-comment"># Ubuntu 16.04</span><br>sudo apt-get install -y python2.7-dev python-pip python-scipy \<br>    python-matplotlib ipython python-wxgtk3.0 python-tk python-igraph python-pyx<br><span class="hljs-comment"># Ubuntu 18.04</span><br>sudo apt-get install -y python3-dev python-pip python-scipy \<br>    python-matplotlib ipython python-wxgtk4.0 python-tk python-igraph python-pyx<br><span class="hljs-comment"># Ubuntu 20.04</span><br>sudo apt-get install -y python3-dev python3-pip python3-scipy \<br>    python3-matplotlib ipython3 python3-wxgtk4.0 python3-tk python3-igraph python3-pyx<br></code></pre></td></tr></table></figure>
</li>
<li>
<p>创建catkin工作区并克隆项目：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 首先我们可以创建一个工作区。</span><br><span class="hljs-built_in">cd</span> yourfloder<br><span class="hljs-built_in">mkdir</span> -p kalibr_workspace/src<br><span class="hljs-built_in">cd</span> kalibr_workspace<br><span class="hljs-built_in">source</span> /opt/ros/melodic/setup.bash  <span class="hljs-comment"># kinetic=16.04, melodic=18.04, noetic=20.04</span><br>catkin init<br>catkin config --extend /opt/ros/melodic<br>catkin config --merge-devel <span class="hljs-comment"># Necessary for catkin_tools &gt;= 0.4.</span><br>catkin config --cmake-args -DCMAKE_BUILD_TYPE=Release  <span class="hljs-comment"># 将其配置为以发布模式构建非常重要，否则优化将会很慢。</span><br><span class="hljs-comment"># 然后我们可以克隆该项目：</span><br><span class="hljs-built_in">cd</span> src<br>git <span class="hljs-built_in">clone</span> https://github.com/ethz-asl/kalibr.git<br></code></pre></td></tr></table></figure>
</li>
<li>
<p>（可选）指定项目编译使用的OpenCV版本。在项目中所有<code>CMakeLists.txt</code>文件出现指定OpenCV的地方：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs cmake"><span class="hljs-keyword">set</span>(OpenCV_DIR /usr/local/opencv/opencv345/share/OpenCV)  <span class="hljs-comment"># 新增</span><br><span class="hljs-keyword">find_package</span>(OpenCV REQUIRED)<br><span class="hljs-comment"># find_package(cv_bridge)  # 如果find_package(OpenCV REQUIRED)报错</span><br><span class="hljs-keyword">include_directories</span>(<span class="hljs-variable">$&#123;OpenCV_INCLUDE_DIRS&#125;</span>)  <span class="hljs-comment"># 新增</span><br><span class="hljs-comment"># 新增</span><br><span class="hljs-keyword">message</span>(STATUS <span class="hljs-string">&quot;opencv version: $&#123;OpenCV_VERSION&#125;&quot;</span>)<br><span class="hljs-keyword">message</span>(STATUS <span class="hljs-string">&quot;opencv lib: $&#123;OpenCV_LIBS&#125;&quot;</span>)<br><span class="hljs-keyword">message</span>(STATUS <span class="hljs-string">&quot;opencv include dir: $&#123;OpenCV_INCLUDE_DIRS&#125;&quot;</span>)<br><span class="hljs-keyword">message</span>(STATUS <span class="hljs-string">&quot;opencv config path: $&#123;openCV_CONFIG_PATH&#125;&quot;</span>)<br></code></pre></td></tr></table></figure>
</li>
<li>
<p>使用<em>Release</em>配置构建代码：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> yourfloder/kalibr_workspace/<br>catkin build -DCMAKE_BUILD_TYPE=Release<br></code></pre></td></tr></table></figure>
<blockquote>
<p>如果编译报错：<code>catkin clean</code>相当于<code>rm -r $&#123;build&#125; $&#123;devel&#125;</code>，但是避免了<code>rm -r</code>这种危险的操作！</p>
</blockquote>
</li>
<li>
<p>构建完成后，您必须获取 catkin 工作区设置以使用 Kalibr ：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># source yourfloder/kalibr_workspace/devel/setup.bash</span><br><span class="hljs-built_in">cd</span> yourfloder/kalibr_workspace/<br><span class="hljs-built_in">source</span> ./devel/setup.bash<br><span class="hljs-comment"># rosrun kalibr &lt;command_you_want_to_run_here&gt;</span><br></code></pre></td></tr></table></figure>
</li>
<li></li>
</ol>
<h1 id="高级用法-2">高级用法</h1>
<h2 id="固件更新">固件更新</h2>
<p>相机上运行的软件可以按如下方式更新：</p>
<ol>
<li>
<p>打开DV：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">dv-gui<br></code></pre></td></tr></table></figure>
</li>
<li>
<p>选择<em>Maintenance -&gt; Update camera firmware</em></p>
</li>
<li>
<p>等待固件更新窗口出现</p>
<img src="/posts/9d7fd48f/%E5%9B%BA%E4%BB%B6%E6%9B%B4%E6%96%B0%E7%95%8C%E9%9D%A2.png" srcset="/img/loading.gif" lazyload class="" title="固件更新界面">
</li>
<li>
<p>如果有可用更新，该工具将显示该更新。如果未列出最新固件版本，您可能需要更新 DV</p>
</li>
<li>
<p>如果可用，请单击 <em>Update firmware</em> 和 <em>Update logic</em></p>
</li>
<li>
<p><strong>拔下并重新插入相机</strong></p>
</li>
</ol>
<h1 id="（单目）校准-标定">（单目）校准/标定</h1>
<blockquote>
<p>我最终标定使用的是<a href="#%E4%BD%BF%E7%94%A8Kalibr%E6%A0%87%E5%AE%9A%E7%9B%B8%E6%9C%BA%E5%86%85%E5%8F%82">使用Kalibr标定相机内参</a>得到的相机内参和<a href="#%E4%BD%BF%E7%94%A8imu_utils%E6%A0%87%E5%AE%9AIMU">使用imu_utils标定IMU</a>后放大5-10倍的IMU参数来<a href="#%E4%BD%BF%E7%94%A8Kalibr%E8%BF%9B%E8%A1%8C%E8%A7%86%E6%83%AF%E8%81%94%E5%90%88%E6%A0%87%E5%AE%9A">使用Kalibr进行视惯联合标定</a>得到的相机-IMU参数。因此，整合到VINS-Mono配置文件里的参数要与这几个参数相对应，例如，而不使用<a href="#%E4%BD%BF%E7%94%A8DV%E6%A0%87%E5%AE%9A%E7%9B%B8%E6%9C%BA%E5%86%85%E5%8F%82">使用DV标定相机内参</a>得到的相机内参。</p>
<p>简单来说，最后看<a href="#%E4%BD%BF%E7%94%A8Kalibr%E8%BF%9B%E8%A1%8C%E8%A7%86%E6%83%AF%E8%81%94%E5%90%88%E6%A0%87%E5%AE%9A">使用Kalibr进行视惯联合标定</a>的结果文件<code>*.yaml</code>就可以了。</p>
</blockquote>
<h2 id="相机参数">相机参数</h2>
<p>DAVIS346提供了变焦 C 接口镜头（<a target="_blank" rel="noopener" href="https://docs.inivation.com/_static/lenses/vari-focal-lens-incl.pdf">数据表</a>）。</p>
<img src="/posts/9d7fd48f/DAVIS346%E7%9B%B8%E6%9C%BA%E9%95%9C%E5%A4%B4.png" srcset="/img/loading.gif" lazyload class="" title="DAVIS346相机镜头">
<p>相机镜头上面有3个可调的圈:</p>
<ol>
<li>
<p><strong>N-F</strong>：这是聚焦（Focus）环。<strong>N</strong> 表示近焦距（Near），<strong>F</strong> 表示远焦距（Far）。通过调整这个环，你可以控制镜头的对焦距离，从而使主体在近距离或远距离处保持清晰。</p>
<blockquote>
<p><strong>聚焦 (Focus)</strong>: 聚焦是指调整相机镜头的设定，使得图像中的特定区域变得清晰。聚焦可以是自动的（如自动对焦，AF），也可以是手动的（如手动对焦，MF）。通过调整镜头使光线正确地汇集在感光元件上，图像的某一部分（或全部）会更为清晰。聚焦对于控制观看者的注意力非常重要，因为人们通常会首先注意到图像中最清晰的部分。</p>
</blockquote>
</li>
<li>
<p><strong>W-T</strong>：这是变焦（Zoom）环。<strong>W</strong> 表示广角端（Wide Angle），<strong>T</strong> 表示长焦端（Telephoto）。通过旋转这个环，你可以在广角和长焦之间切换，改变镜头的视场范围。</p>
<blockquote>
<p><strong>变焦 (Zoom)</strong>: 变倍功能通过调整镜头来改变视角的宽窄，即用来控制画面的放大程度。变倍可以是光学的或是数字的。光学变倍通过物理移动镜头元素来放大图像，保持图像质量不受损失。数字变倍则是通过软件放大图像的一部分，这通常会降低图像质量。变倍功能使得摄影师可以在不改变位置的情况下，拍摄不同大小和距离的对象。</p>
</blockquote>
</li>
<li>
<p><strong>O-C</strong>：这是光圈（Aperture）环。<strong>O</strong> 表示开放（Open），<strong>C</strong> 表示关闭（Close）。光圈控制镜头的光线进入量，从而影响曝光和景深。开放光圈（较大光圈）适用于低光条件和浅景深，而关闭光圈（较小光圈）适用于明亮环境和深景深。</p>
<blockquote>
<p><strong>光圈 (Aperture)</strong>: 光圈是镜头中用来控制透过镜头到达感光元件的光线量的部件。光圈大小用f数（如f/2.8, f/8等）来表示，数字越小，光圈开得越大，进光量就越多，反之亦然。光圈不仅影响到照片的曝光量，也影响到画面的景深（即图像中清晰显示的范围），光圈越大（数值越小），景深越浅，背景越模糊，这样可以让主体更加突出。</p>
</blockquote>
</li>
</ol>
<p>相机镜头上标注的参数“4-12mm，1/2''，IR”表示了镜头的几个关键特性：</p>
<ol>
<li><strong>4-12mm</strong>：这是镜头的焦距范围。焦距是从镜头到焦点（成像平面上形成清晰图像的地方）的距离。4-12mm 表示这是一个变焦镜头，可以调整焦距，通常用于可变放大图像的能力。焦距越短，视场越广；焦距越长，可以看到更远的细节。</li>
<li><strong>1/2''</strong>：这表示镜头的格式大小，是指成像传感器的物理尺寸。1/2英寸大小的传感器是指传感器的对角线长度大约为1/2英寸，这会影响到镜头的视场和成像质量。传感器越大，通常能够捕获更多的光线和详情，提高图像质量。</li>
<li><strong>IR</strong>：这代表镜头支持红外摄影。IR即红外线，这种镜头可以在红外光照下工作，适用于低光或无光照条件下的拍摄，如夜视设备。</li>
</ol>
<p>综上所述，这些参数主要涉及到镜头的焦距（聚焦和变焦能力）和支持的传感器大小（影响成像质量和视场），以及适用于特定光线环境（红外摄影）。</p>
<h2 id="相机调节顺序">相机调节顺序</h2>
<p>GPT是这样说的：</p>
<blockquote>
<p>在使用相机时，正确的设置顺序可以帮助你获得最佳的图像质量。通常，调节相机的聚焦、变倍和光圈的顺序如下：</p>
<ol>
<li><strong>聚焦 (Focus)</strong>: 首先确定焦点。这是因为变倍和光圈的调整可能会影响焦点的准确性。确保主题清晰锐利是获得高质量照片的关键。</li>
<li><strong>变焦 (Zoom)</strong>: 在调整好焦点之后，你可以根据需要调整镜头的变倍，以确定拍摄的构图。调整变倍之后，可能需要微调聚焦。</li>
<li><strong>光圈 (Aperture)</strong>: 最后调整光圈，因为它会影响图像的曝光和景深。调整光圈可以帮助你控制背景的模糊程度和图像的光线量。</li>
</ol>
<p>每次改变这些设置后，检查图像是否符合你的预期，必要时进行微调。这样可以确保每个组件都精确地协同工作，以产生最佳的图像效果。</p>
</blockquote>
<p>但是在实际使用<code>dv-gui</code>中（在室内），我注意到图像帧的帧率只有几fps（把鼠标放在图像帧上，图像顶部就显示帧率了），而<a href="#%E4%BA%A7%E5%93%81%E7%BB%86%E8%8A%82">产品细节</a>上则标明<code>DAVIS346</code>的图像帧帧率可以达到40fps。于是我将<code>dv-gui</code>右侧工具栏的<code>Aps</code>选项下的<code>FRAME INTERVAL</code>参数设置成了25000，以希望获得40fps（1/25000us）的图像帧输出，无果。</p>
<p>而当我把相机镜头对准室外几秒后，图像帧的帧率就可以达到30fps以上了。然后，我注意到<code>dv-gui</code>默认勾选了<code>Aps</code>选项下的<code>AUTO EXPOSURE</code>。在室内，<code>Aps</code>下的曝光值为接近300000；在室外，曝光值自动调节到了6000左右。</p>
<blockquote>
<p>现在看来，可能是因为我桌子上的灯太亮了，导致相机“误判”了曝光值，使得室内和室外的曝光值差距很大。</p>
</blockquote>
<p>于是，可以得出结论，图像帧的帧率是跟曝光值有关。</p>
<p>那想要在室内（曝光值很大的地方）获得高帧率（40fps）的图像帧，应该怎么办？</p>
<p>经试验，取消勾选<code>Aps</code>选项下的<code>AUTO EXPOSURE</code>，手动设置<code>Exposure</code>参数值为6000（较小的值），需要调大相机光圈才能显示出室内物体（否则一片黑）。那么，反过来，易知相机光圈越大，曝光值就可以设置的越小（<code>dv-gui</code>自动调节的曝光值也会减小），这样，就可以取得更高的图像帧帧率了。当然，大的光圈会减少传感器接收到的光量，应该会对事件相机采集的数据有影响。</p>
<p>因此，需要调节事件相机（比如说下面的<a href="#%E5%AF%B9%E7%84%A6">对焦</a>过程），但又想要图像帧保持高帧率，我认为可行的调节顺序是：</p>
<blockquote>
<ul>
<li>对于室内环境：
<ol>
<li>取消勾选<code>dv-gui</code>右侧工具栏的<code>Aps</code>选项下的<code>AUTO EXPOSURE</code>，手动设置<code>Exposure</code>参数值为6000（较小的值）。</li>
<li>将<code>FRAME INTERVAL</code>参数设置为25000（以使图像帧输出帧率可以达到40fps）。</li>
<li>将相机的聚焦环、光圈和变焦环初始旋转依次固定在N C W端。此时，<code>dv-gui</code>中间的<code>noiseFliter/events</code>界面是一片黑，上边跳动的是噪点；<code>capture/frames</code>界面是一片黑。</li>
<li>首先旋转光圈，直到<code>dv-gui</code>中间的<code>capture/frames</code>界面由一片黑变得可以看清物体。
<ul>
<li>在光圈旋转过程中，<code>noiseFliter/events</code>界面首先出现图像，然后再是<code>capture/frames</code>界面。</li>
<li>光圈尽量不要旋转太大，<code>capture/frames</code>界面由一片黑变得可以能看清物体就行。大的光圈会减少传感器接收到的光量，应该会对事件相机采集的数据有影响。</li>
</ul>
</li>
<li>然后旋转聚焦环，旋转过程中应该有个临界点，在临界点处<code>noiseFliter/events</code>界面图像边缘最清晰，在临界点处左右转图像都会变模糊。</li>
<li>最后旋转变焦环，使<code>noiseFliter/events</code>界面图像边缘更清晰。同样存在临界点。</li>
<li>此时，<code>noiseFliter/events</code>界面图像边缘最清晰，<code>capture/frames</code>界面也有图像且帧率很高。</li>
<li>拧紧聚焦环和变焦环上的螺丝，防止镜头发生滑动。</li>
<li>（可选）点击<code>dv-gui</code>上方工具栏的<code>Flie</code>-<code>save project as</code>，将当前的配置保存为<code>.xml</code>文件，方便后续直接调用。</li>
<li>（可选）勾选回<code>dv-gui</code>右侧工具栏的<code>Aps</code>选项下的<code>AUTO EXPOSURE</code>，此时<code>capture/frames</code>界面的图像帧帧率会减少，但也不至于会减少到只有几帧了。</li>
</ol>
</li>
<li>对于室外环境，可以不取消勾选<code>dv-gui</code>右侧工具栏的<code>Aps</code>选项下的<code>AUTO EXPOSURE</code>（室外环境就算是自动调节也不会把曝光值调得很高，导致图像帧帧率很低），按照上述光圈、聚焦环、变焦环的顺序依次调节即可。</li>
</ul>
</blockquote>
<blockquote>
<p>有时候开启了自动曝光，但是曝光值还是不随环境变化，这时候关闭自动曝光，手动改变一下曝光值，再开始自动曝光就可以了。</p>
</blockquote>
<blockquote>
<p>20240521更新：</p>
<p>在夜晚室内测试时，我发现就算开着灯，曝光值也需要调大很大图像帧才能看清物体，而此时图像帧的帧率就会很低。参考<a target="_blank" rel="noopener" href="https://blog.csdn.net/gwplovekimi/article/details/121619039">博客</a>里的说法，应该把中间的光圈调大最大（尽可能降低曝光值），把最外面的聚焦环调到最远，然后再调节最里面的变焦环进行对焦。如果变焦环调到最大相机还是没有对焦，就回调提下聚焦环。</p>
</blockquote>
<h2 id="相机对焦">相机对焦</h2>
<blockquote>
<p>DAVIS346因为事件帧和图像帧共用的是一个镜头，所以可以直接通过标定图像帧来同时确定事件帧和图像帧的内参及视惯联合标定。</p>
<p>因此，更推荐直接对焦图像帧（方便接下来使用Kalibr进行标定过程中角点的提取，图像帧太模糊的话效果不好）（简单操作的话，直接对焦接下来使用Kalibr的<a href="#%E4%BD%BF%E7%94%A8Kalibr%E6%A0%87%E5%AE%9A%E7%9B%B8%E6%9C%BA%E5%86%85%E5%8F%82">标定板</a>，使相机能看清标定板即可），而不是对焦事件数据。（图像帧对焦好了，事件数据的对焦也不会太差？因为二者共用的一个镜头。）</p>
</blockquote>
<h3 id="使用DV对焦事件数据">使用DV对焦事件数据</h3>
<p>对于任何相机来说，对焦都可能很棘手，但如果您没有正常的框架，那就更难了。在这个小教程中，您将学习如何正确对焦仅事件相机。</p>
<p>聚焦事件专用摄像机的最简单方法是使用 Siemens Star。</p>
<img src="/posts/9d7fd48f/siemens-star.gif" srcset="/img/loading.gif" lazyload class="" title="Siemens Star">
<p>要对事件摄像机进行对焦，您可以按照以下步骤操作：</p>
<ol>
<li>
<p>使用高分辨率显示器显示旋转的西门子之星，如上所示。或者，将西门子之星 (<a target="_blank" rel="noopener" href="https://docs.inivation.com/_static/calibration/siemens-star-24.pdf">PDF</a>) 打印在纸上。将相机放置在远离西门子之星的位置，即您想要对焦的距离处。星星应该在画面中央清晰可见。</p>
</li>
<li>
<p>启动 DV 软件来可视化相机。</p>
</li>
<li>
<p>（开始按照<a href="#%E7%9B%B8%E6%9C%BA%E8%B0%83%E8%8A%82%E9%A1%BA%E5%BA%8F">相机调节顺序</a>进行调节，下面的过程是官网提供的过程，可以作为参考和补充）</p>
</li>
<li>
<p>放大事件输出可视化工具或通过单击专用按钮使其全屏显示。</p>
</li>
<li>
<p>旋转镜头上的聚焦环。如果您有西门子星的纸质打印件，请通过稍微摇动相机或图案来继续生成事件。首先，如果相机失焦，您可能会看到如下图所示的内容。</p>
<img src="/posts/9d7fd48f/focus-notfocus.png" srcset="/img/loading.gif" lazyload class="" title="not in focus">
</li>
<li>
<p>调整聚焦环，直到图案的中心清晰可见。下面是使用聚焦相机的输出示例。</p>
<blockquote>
<p>要获得更大的景深（对焦范围），您需要更高的 f 值，这也会减少传感器接收到的光量。</p>
</blockquote>
<img src="/posts/9d7fd48f/focus-infocus.png" srcset="/img/loading.gif" lazyload class="" title="in focus">
</li>
</ol>
<h3 id="使用Kalibr进行对焦">使用Kalibr进行对焦</h3>
<p>将相机对准具有高频成分的场景（例如西门子星形、棋盘格）并调整焦点，同时尝试最小化计算出的焦点测量值。</p>
<p>该工具可以通过以下方式启动：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">kalibr_camera_focus --topic [IMAGE_TOPIC]  <span class="hljs-comment"># 该工具订阅相机的图像主题并显示实时图像以及焦点测量值</span><br></code></pre></td></tr></table></figure>
<img src="/posts/9d7fd48f/%E4%BD%BF%E7%94%A8Kalibr%E8%BF%9B%E8%A1%8C%E5%AF%B9%E7%84%A6.png" srcset="/img/loading.gif" lazyload class="" title="使用Kalibr进行对焦">
<h2 id="标定相机内参">标定相机内参</h2>
<h3 id="使用DV标定相机内参">使用DV标定相机内参</h3>
<p><a target="_blank" rel="noopener" href="https://inivation.com/developer/tutorials/">官方视频教程</a></p>
<p>在对完焦，拧上螺丝，保证相机镜头不变后，就可以标定相机内参了。</p>
<blockquote>
<p>同样的，如果重新旋转了相机镜头，就需要重新标定一遍相机内参了。</p>
</blockquote>
<blockquote>
<p>DAVIS346因为事件帧和图像帧共用的是一个镜头，所以可以直接通过标定图像帧来同时确定事件帧和图像帧的内参及视惯联合标定。如果是DVXplorer相机，就会更麻烦一些，需要使用到事件累加器等功能。目前还没有用到DVXplorer，暂收不提。</p>
</blockquote>
<ol>
<li>
<p>可用的校准图案包括：标准棋盘（<a target="_blank" rel="noopener" href="https://docs.inivation.com/_static/calibration/calib.io-checker-279x210-6x9-30.pdf">下载 PDF</a>）、圆形网格（<a target="_blank" rel="noopener" href="https://docs.inivation.com/_static/calibration/calib.io-circles-279x210-6x9-30-15.pdf">下载 PDF</a>）和不对称圆形网格（<a target="_blank" rel="noopener" href="https://docs.inivation.com/_static/calibration/calib.io-circlesA-279x210-9x12-28.2842-15.pdf">下载 PDF</a>）。将校准图案打印到A4纸上。在本教程中，使用正方形尺寸为 30 毫米的 6 x 9 棋盘。</p>
<blockquote>
<p>注意打印的时候选择打印实际大小，而不是让默认的打印机自己调整到合适的大小（会小于30mm）。尽可能保证数据的准确性。</p>
</blockquote>
</li>
<li>
<p>打开<code>dv-gui</code>，点击中间上面的<code>Structure</code>选项，开始将系统结构从可视化结构搭建到标定结构。</p>
</li>
<li>
<p>选中模块，点击上面的<code>Remove module</code>可以删除模块；点击<code>Add module</code>可以增加模块；使用鼠标可以在两个模块之间进行连线。最终，将系统结构搭建为如下所示：</p>
<img src="/posts/9d7fd48f/DAVIS346%E6%A0%87%E5%AE%9A%E7%95%8C%E9%9D%A2%E8%AE%BE%E7%BD%AE.png" srcset="/img/loading.gif" lazyload class="" title="DAVIS346标定界面设置">
</li>
<li>
<p>应当注意的是，正方形尺寸可以用任何长度尺度来表示。</p>
</li>
<li>
<p>点击<code>dv-gui</code>右侧<code>Calibration</code>旁的<code>+</code>号，展开<code>Calibration</code>的详细参数配置。</p>
<ol>
<li>必须根据校准图案设置以下参数：板的高度（board height）和宽度（board width）、方块尺寸（square size）和图案类型（pattern type）。在本教程中，使用正方形尺寸为 30 毫米的 6 x 9 棋盘。所以宽度应设置为9，高度设置为6，正方形大小设置为30mm；这些已经是默认值。</li>
<li>找到<code>OUTPUT CALBRATION DIRECTORY</code>选项，确定标定结果的输出路径。</li>
<li>（可选）配置最小检测数（Min Detections），默认为30。</li>
</ol>
</li>
<li>
<p>开始校准。点击<code>dv-gui</code>中间上面的<code>Output</code>选项，回到可视化界面。</p>
</li>
<li>
<p>依次点击<code>dv-gui</code>右侧<code>Capture</code>和<code>Calibration</code>栏下方的开始播放按钮。</p>
</li>
<li>
<p>开始在相机前面开始缓慢移动校准图案。如果检测到图案，它将绘制在输出图像上。该模块收集一定数量（上方设置的最小检测数）的图像用于实际校准。一旦在一定数量的帧上一致检测到图案，图像就会添加到集合中，（可在“Consec Detects”下进行配置）。添加图像后，将出现一条日志消息。</p>
</li>
<li>
<p>找到并添加图案的区域将变成浅绿色。为了获得良好的校准结果，应该用均匀的绿色阴影覆盖整个图像。可以通过取消选中突出显示区域选项来关闭此功能。</p>
<img src="/posts/9d7fd48f/calibration-highlights.png" srcset="/img/loading.gif" lazyload class="" title="The area where patterns have been found is highlighted in green">
</li>
<li>
<p>一旦收集到足够的图像，如果勾选“Check Images”，用户就可以验证它们。将依次显示保存的图像和检测到的图案。用户可以通过按配置面板中的相应按钮来选择保留（Keep）或丢弃（Discard）它们。</p>
<blockquote>
<p>为了获得良好的校准结果，重要的是丢弃图像，尽管已检测到图案，但某些点放置不准确或与其他点未对准，或者在图像的子区域中收集了太多图像。</p>
</blockquote>
<img src="/posts/9d7fd48f/%E6%A0%87%E5%AE%9AKeep.png" srcset="/img/loading.gif" lazyload class="" title="标定Keep">
</li>
<li>
<p>收集新图像来替换丢弃的图像，一旦全部通过检查（至少点击了<code>Min Detections</code>次<code>Keep</code>），校准计算就开始。计算过程中可能会有一些延迟，具体取决于硬件和使用的图像数量。</p>
<blockquote>
<p>有两个误差指标：最大允许误差（maximum allowable error）可以在最大重投影误差（Max Reprojection Error）下设置；极线误差（epipolar line error）计算为所有收集的图像对中每个点的平均极线误差。</p>
</blockquote>
</li>
<li>
<p>如果校准足够准确，则会将其保存在输出目录中，并显示相机的未失真输出。还可以选择“保存图像（Save Images）”选项，以 <code>*.png</code> 格式保存校准过程中使用的图像。</p>
</li>
<li>
<p>如果校准不成功，则应使用增加的图像数量重新启动。要在不存储图像的情况下从头开始重新启动，只需停止并再次启动模块即可。</p>
</li>
<li>
<p>最后，按不同运动方向多标定几次，选<code>calibration_error</code>最小的那个。</p>
</li>
<li>
<p>（可选）点击<code>dv-gui</code>上方工具栏的File-Save project as，将当前的配置（Output参数和Struture结构）保存为<code>*.xml</code>文件，方便下次直接导入使用。</p>
</li>
</ol>
<p>标定输出的<code>*.xml</code>文件如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">opencv_storage</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">DAVIS346_00001043</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">camera_matrix</span> <span class="hljs-attr">type_id</span>=<span class="hljs-string">&quot;opencv-matrix&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">rows</span>&gt;</span>3<span class="hljs-tag">&lt;/<span class="hljs-name">rows</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">cols</span>&gt;</span>3<span class="hljs-tag">&lt;/<span class="hljs-name">cols</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dt</span>&gt;</span>d<span class="hljs-tag">&lt;/<span class="hljs-name">dt</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">data</span>&gt;</span><br>      1.8202117774560909e+02 0. 1.5745352808080008e+02 0.<br>      1.8212804158992162e+02 1.1349927340700411e+02 0. 0. 1.<span class="hljs-tag">&lt;/<span class="hljs-name">data</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">camera_matrix</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">distortion_coefficients</span> <span class="hljs-attr">type_id</span>=<span class="hljs-string">&quot;opencv-matrix&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">rows</span>&gt;</span>5<span class="hljs-tag">&lt;/<span class="hljs-name">rows</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">cols</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">cols</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dt</span>&gt;</span>d<span class="hljs-tag">&lt;/<span class="hljs-name">dt</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">data</span>&gt;</span><br>      -2.3109837702623912e-01 7.9035977463110155e-02<br>      1.2918986417452307e-02 4.8632341326678872e-03<br>      -1.1962406017180151e-02<span class="hljs-tag">&lt;/<span class="hljs-name">data</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">distortion_coefficients</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">image_width</span>&gt;</span>346<span class="hljs-tag">&lt;/<span class="hljs-name">image_width</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">image_height</span>&gt;</span>260<span class="hljs-tag">&lt;/<span class="hljs-name">image_height</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">DAVIS346_00001043</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">use_fisheye_model</span>&gt;</span>0<span class="hljs-tag">&lt;/<span class="hljs-name">use_fisheye_model</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">type</span>&gt;</span>camera<span class="hljs-tag">&lt;/<span class="hljs-name">type</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">pattern_width</span>&gt;</span>8<span class="hljs-tag">&lt;/<span class="hljs-name">pattern_width</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">pattern_height</span>&gt;</span>5<span class="hljs-tag">&lt;/<span class="hljs-name">pattern_height</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">pattern_type</span>&gt;</span>chessboard<span class="hljs-tag">&lt;/<span class="hljs-name">pattern_type</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">board_width</span>&gt;</span>9<span class="hljs-tag">&lt;/<span class="hljs-name">board_width</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">board_height</span>&gt;</span>6<span class="hljs-tag">&lt;/<span class="hljs-name">board_height</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">square_size</span>&gt;</span>30.<span class="hljs-tag">&lt;/<span class="hljs-name">square_size</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">calibration_error</span>&gt;</span>4.1753813020464015e-01<span class="hljs-tag">&lt;/<span class="hljs-name">calibration_error</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">calibration_time</span>&gt;</span>&quot;Thu May 16 16:50:52 2024&quot;<span class="hljs-tag">&lt;/<span class="hljs-name">calibration_time</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">opencv_storage</span>&gt;</span><br></code></pre></td></tr></table></figure>
<p>转化为<a target="_blank" rel="noopener" href="https://github.com/HKUST-Aerial-Robotics/VINS-Mono">VINS-Mono</a>的相机配置文件<code>*.yaml</code>格式为：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-string">%YAML:1.0</span><br><span class="hljs-meta">---</span><br><span class="hljs-attr">model_type:</span> <span class="hljs-string">PINHOLE</span><br><span class="hljs-attr">camera_name:</span> <span class="hljs-string">camera</span><br><span class="hljs-attr">image_width:</span> <span class="hljs-number">346</span><br><span class="hljs-attr">image_height:</span> <span class="hljs-number">260</span><br><span class="hljs-attr">distortion_parameters:</span><br>   <span class="hljs-attr">k1:</span> <span class="hljs-number">-0.23109837702623912</span><br>   <span class="hljs-attr">k2:</span> <span class="hljs-number">0.07903597746311016</span><br>   <span class="hljs-attr">p1:</span> <span class="hljs-number">0.012918986417452307</span><br>   <span class="hljs-attr">p2:</span> <span class="hljs-number">0.004863234132667887</span><br>   <span class="hljs-attr">k3:</span> <span class="hljs-number">-0.011962406017180152</span><br><span class="hljs-attr">projection_parameters:</span><br>   <span class="hljs-attr">fx:</span> <span class="hljs-number">182.02117774560909</span><br>   <span class="hljs-attr">fy:</span> <span class="hljs-number">182.12804158992162</span><br>   <span class="hljs-attr">cx:</span> <span class="hljs-number">157.45352808080008</span><br>   <span class="hljs-attr">cy:</span> <span class="hljs-number">113.49927340700411</span><br></code></pre></td></tr></table></figure>
<h3 id="使用rpg-dvs-ros标定相机内参（TODO）">使用rpg_dvs_ros标定相机内参（TODO）</h3>
<p><a target="_blank" rel="noopener" href="https://github.com/uzh-rpg/rpg_dvs_ros/blob/master/dvs_calibration/README.md">https://github.com/uzh-rpg/rpg_dvs_ros/blob/master/dvs_calibration/README.md</a></p>
<h3 id="使用Kalibr标定相机内参">使用Kalibr标定相机内参</h3>
<p><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?app=desktop&amp;v=puNXsnrYWTY">官方视频教程-1</a>：图像帧帧率20Hz，IMU帧率200Hz。相机实操+程序运行。没有限制频率。</p>
<p><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=BtzmsuJemgI">官方视频教程-2</a>：图像帧帧率30Hz，IMU帧率400Hz。原理讲解+程序运行。执行标定命令时指定参数<code>--bag-freq 10.0</code>。</p>
<p><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=rBT5O5TEOV4">官方视频教程-3</a>：图像帧帧率30Hz，IMU帧率200Hz。原理讲解+相机实操+程序运行。执行标定命令时指定参数<code>--bag-freq 10.0</code>。</p>
<ol>
<li>
<p>准备标定板。推荐使用<a target="_blank" rel="noopener" href="https://github.com/ethz-asl/kalibr/wiki/downloads">Aprilgrid 6x6 0.8x0.8 m (A0 page)</a>，配置文件<a target="_blank" rel="noopener" href="https://github.com/ethz-asl/kalibr/wiki/downloads">下载链接</a>。</p>
<ol>
<li>
<p>使用A0纸打印Aprilgrid，如果没有A0大小的纸，将标定板缩放到A4大小打印出来也行？</p>
<blockquote>
<p>在最小校准目标周围保留白色边框，一个网格元素的大小（否则在某些光照条件下检测可能不成功）。</p>
</blockquote>
</li>
<li>
<p>编写标定板的配置文件，内容示例：</p>
<p><code>april_A0.yaml</code>：</p>
<img src="/posts/9d7fd48f/%E6%B5%8B%E9%87%8F%E6%A0%87%E5%AE%9A%E6%9D%BF%E7%9A%84tagSize.png" srcset="/img/loading.gif" lazyload class="" title="测量标定板的tagSize">
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">target_type:</span> <span class="hljs-string">&#x27;aprilgrid&#x27;</span> <span class="hljs-comment">#gridtype</span><br><span class="hljs-comment"># 内侧角点的数量，不是格子数量</span><br><span class="hljs-attr">tagCols:</span> <span class="hljs-number">6</span>               <span class="hljs-comment">#number of apriltags</span><br><span class="hljs-attr">tagRows:</span> <span class="hljs-number">6</span>               <span class="hljs-comment">#number of apriltags</span><br><span class="hljs-attr">tagSize:</span> <span class="hljs-number">0.088</span>           <span class="hljs-comment">#size of apriltag, edge to edge [m] 上面截图中为 0.02m</span><br><span class="hljs-attr">tagSpacing:</span> <span class="hljs-number">0.3</span>          <span class="hljs-comment">#ratio of space between tags to tagSize</span><br>                         <span class="hljs-comment">#example: tagSize=2m, spacing=0.5m --&gt; tagSpacing=0.25[-]</span><br><span class="hljs-attr">codeOffset:</span> <span class="hljs-number">0</span>            <span class="hljs-comment">#code offset for the first tag in the aprilboard</span><br></code></pre></td></tr></table></figure>
<p><code>april_A4.yaml</code>：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">target_type:</span> <span class="hljs-string">&#x27;aprilgrid&#x27;</span> <span class="hljs-comment">#gridtype</span><br><span class="hljs-attr">tagCols:</span> <span class="hljs-number">6</span>               <span class="hljs-comment">#number of apriltags</span><br><span class="hljs-attr">tagRows:</span> <span class="hljs-number">6</span>               <span class="hljs-comment">#number of apriltags</span><br><span class="hljs-attr">tagSize:</span> <span class="hljs-number">0.024</span>           <span class="hljs-comment">#size of apriltag, edge to edge [m] 上面截图中为 0.02m</span><br><span class="hljs-attr">tagSpacing:</span> <span class="hljs-number">0.3125</span>          <span class="hljs-comment">#ratio of space between tags to tagSize</span><br><span class="hljs-attr">codeOffset:</span> <span class="hljs-number">0</span>            <span class="hljs-comment">#code offset for the first tag in the aprilboard</span><br></code></pre></td></tr></table></figure>
<blockquote>
<p>大多数打印机会在打印过程中缩放目标。确保重新测量重要尺寸并相应调整目标配置。</p>
</blockquote>
</li>
</ol>
</li>
<li>
<p>录制rosbag包。使用<code>dv-gui</code><a href="#%E5%BD%95%E5%88%B6">录制</a>生成<code>*.aedat4</code>文件，然后将其<a href="#%E8%BD%AC%E4%B8%BAbag%E5%8C%85%E6%A0%BC%E5%BC%8F">转化</a>为<code>*.bag</code>文件；也可以直接<a href="#%E4%BD%BF%E7%94%A8ROS%E5%91%BD%E4%BB%A4%E8%BF%9B%E8%A1%8C%E5%BD%95%E5%88%B6">使用ROS命令进行录制</a>。</p>
<blockquote>
<p>该录制的bag包同样可以供<a href="#%E4%BD%BF%E7%94%A8Kalibr%E8%BF%9B%E8%A1%8C%E8%A7%86%E6%83%AF%E8%81%94%E5%90%88%E6%A0%87%E5%AE%9A">使用Kalibr进行视惯联合标定</a>过程使用。</p>
</blockquote>
<p>录制要求：</p>
<ul>
<li>
<p>建议在捕获校准数据时将相机流的频率降低至 4 Hz 左右。这减少了数据集中的冗余信息，从而缩短了校准的运行时间。</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?app=desktop&amp;v=puNXsnrYWTY">官方视频教程-1</a>中图像帧帧率20Hz，IMU帧率200Hz，没有做降频处理，直接运行的标定命令。</p>
<p><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=BtzmsuJemgI">官方视频教程-2</a>中图像帧的频率是30Hz（通过<code>rosbag info</code>命令得到bag的录制时间是35.4s，期间一共有1024个图像消息），在下面执行标定命令时指定参数<code>--bag-freq 10.0</code>。</p>
<p><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=BtzmsuJemgI">官方视频教程-2</a>中图像帧的频率是30Hz，在下面执行标定命令时指定参数<code>--bag-freq 10.0</code>。</p>
</blockquote>
<blockquote>
<p>当然，bag包主题的频率也可以使用<a href="https://zeyulong.com/posts/c4541b88/#rosbag">ROS命令</a>进行修改。</p>
</blockquote>
<blockquote>
<p>实测这两种降频结果差距不大？主要还是标定过程录制的bag包质量要尽可能高。</p>
</blockquote>
</li>
<li>
<p>确保您的传感器处于焦点。<a href="#%E4%BD%BF%E7%94%A8DV%E8%BF%9B%E8%A1%8C%E5%AF%B9%E7%84%A6">使用DV进行对焦</a>、<a href="#%E4%BD%BF%E7%94%A8Kalibr%E8%BF%9B%E8%A1%8C%E5%AF%B9%E7%84%A6">使用Kalibr进行对焦</a></p>
</li>
<li>
<p>通过减少曝光时间来限制运动模糊。</p>
</li>
<li>
<p>相机系统固定，标定目标（板）在相机前面移动以获得标定图像。</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/ethz-asl/kalibr/wiki">官方wiki教程</a>上是这么说的，但是<a target="_blank" rel="noopener" href="https://www.youtube.com/watch?app=desktop&amp;v=puNXsnrYWTY">官方视频教程-1</a>和<a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=BtzmsuJemgI">官方视频教程-2</a>里是固定标定板，运行相机。</p>
</blockquote>
</li>
<li>
<p>确保覆盖相机的整个视野，确保从不同方向、距离以及图像平面的每个部分都可以看到校准板。</p>
<ul>
<li>争取把标定板晃动到过相机像素平面的每个地方。</li>
</ul>
</li>
<li>
<p>使用倾斜视图和到校准目标的不同距离。</p>
</li>
<li>
<p>相机不能离标定板太远，太远执行标定过程中就检测不到角点了。</p>
</li>
<li>
<p>运动幅度尽量大一点，保证激励IMU。</p>
</li>
</ul>
<p>实施步骤：</p>
<blockquote>
<ul>
<li>注意运动平滑，速度不要太快。</li>
<li>标定板始终在相机视野内。</li>
<li>持续1分钟以上以获得足够的数据。</li>
</ul>
</blockquote>
<ol>
<li>相机纵向俯仰绕标定板来回旋转3次。</li>
<li>相机横向偏航绕标定板来回旋转3次。</li>
<li>相机自身（对准标定板）上下旋转3次。</li>
<li>相机左右水平来回运动3次。</li>
<li>相机上下水平来回运动3次。</li>
<li>相机前后水平来回运动3次。</li>
<li>相机随机运动。</li>
</ol>
</li>
<li>
<p>执行标定。</p>
<p>必选参数：</p>
<ul>
<li>
<p><code>--bag filename.bag</code>：包含图像数据的 ROS 包</p>
</li>
<li>
<p><code>-topics TOPIC_0 ... TOPIC_N</code>：包中所有相机主题的列表。匹配 <code>--models</code> 的顺序</p>
</li>
<li>
<p><code>--models MODEL_0 ... MODEL_N</code>：要安装的相机/畸变模型列表。与 <code>--topics</code> 的顺序匹配（请参阅<a target="_blank" rel="noopener" href="https://github.com/ethz-asl/kalibr/wiki/supported-models">支持的型号</a>）</p>
</li>
<li>
<p><code>--target target.yaml</code>：标定目标（板）的配置文件</p>
</li>
</ul>
<p>可选参数：</p>
<ul>
<li><code>--show-extraction</code>：可视化校准目标提取过程。这可能有助于发现目标配置和提取的问题。</li>
</ul>
<p>运行示例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># kalibr_calibrate_cameras --bag [filename.bag] --topics [TOPIC_0 ... TOPIC_N] --models [MODEL_0 ... MODEL_N] --target [target.yaml] --show-extraction</span><br><br><span class="hljs-built_in">cd</span> yourfloder/kalibr_workspace<br>roscore<br><span class="hljs-built_in">source</span> ./devel/setup.bash &amp;&amp; rosrun kalibr kalibr_calibrate_cameras \<br> 	--target april_6x6.yaml \<br> 	--models pinhole-radtan pinhole-radtan \<br> 	--topics /cam0/image_raw /cam1/image_raw \<br> 	--bag cam_april.bag \<br> 	--bag-freq 10.0 \  <span class="hljs-comment"># 提取特征的频率/Hz。根据指定频率向下采样，删除多余的图片。</span><br> 	--bag-from-to 10 100 \  <span class="hljs-comment"># 处理bag中10-100秒的数据</span><br> 	--show-extraction<br></code></pre></td></tr></table></figure>
<blockquote>
<p>由于对焦距的初始猜测错误，在处理前几张图像后，优化可能会出现偏差。在这种情况下，只需尝试重新启动校准，因为初始猜测是基于随机选择的图像。</p>
</blockquote>
<blockquote>
<p>使用 help 参数可以获得有关选项的更多信息：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">kalibr_calibrate_cameras --h<br></code></pre></td></tr></table></figure>
</blockquote>
</li>
<li>
<p>输出。校准将在<code>*.bag</code>路径下产生以下输出：</p>
<ul>
<li><code>report-cam-%BAGNAME%.pdf</code>：PDF 格式的报告。包含文档的所有图。</li>
<li><code>results-cam-%BAGNAME%.txt</code>：结果摘要作为文本文件。</li>
<li><code>camchain-%BAGNAME%.yaml</code>：YAML格式的结果。该文件可用作<a href="#%E4%BD%BF%E7%94%A8Kalibr%E8%BF%9B%E8%A1%8C%E8%A7%86%E6%83%AF%E8%81%94%E5%90%88%E6%A0%87%E5%AE%9A">视惯联合标定</a>的输入。<a href="#Kalibr%E7%9A%84%E8%BE%93%E5%87%BA%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F">Kalibr的输出文件格式</a></li>
</ul>
</li>
<li>
<p>结果检验。</p>
<ul>
<li>
<p><code>report-cam-%BAGNAME%.pdf</code>报告第1页的重投影误差（reprojection error） &lt; 0.2-0.5 。</p>
</li>
<li>
<p>检查结果图，如良好的校准具有小于 &lt; 0.2-0.5 像素重投影误差（<code>report-cam-%BAGNAME%.pdf</code>报告第5页）。如果您计划对相机进行在线校准，则可能可以接受较大的值（例如 1 像素），但始终首选更准确的离线校准。</p>
<img src="/posts/9d7fd48f/%E9%87%8D%E6%8A%95%E5%BD%B1%E8%AF%AF%E5%B7%AE%E7%A4%BA%E4%BE%8B.png" srcset="/img/loading.gif" lazyload class="" title="重投影误差示例">
</li>
<li>
<p>验证实时图像流的校准。</p>
</li>
</ul>
</li>
<li>
<p>可选的实时验证（仅限 ROS）。验证工具提取 ROS 图像流上的校准目标，并显示与提取的角点的重投影重叠的图像。此外，计算并显示单相机和相机间重投影误差的重投影误差统计数据。该工具必须提供相机系统校准文件和校准目标的配置。多相机校准器的输出 YAML 可以用作相机系统配置。用法如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> yourfloder/kalibr_workspace<br>roscore<br><span class="hljs-built_in">source</span> ./devel/setup.bash &amp;&amp; rosrun kalibr kalibr_camera_validator --cam camchain-%BAGNAME%.yaml --target april_6x6.yaml<br></code></pre></td></tr></table></figure>
<blockquote>
<p>运行时报错：</p>
<p>Traceback (most recent call last):<br>
File &quot;/kalibr_workspace/src/kalibr/aslam_offline_calibration/kalibr/python/kalibr_camera_validator&quot;, line 500, in <module><br>
chain_validator = CameraChainValidator(camchain, targetConfig)<br>
File &quot;/kalibr_workspace/src/kalibr/aslam_offline_calibration/kalibr/python/kalibr_camera_validator&quot;, line 78, in <strong>init</strong><br>
cv2.resizeWindow(monovalidator.windowName, (640, 480))<br>
TypeError: an integer is required</p>
</blockquote>
<p>结果示例：</p>
<ul>
<li>
<p>单目相机结果：</p>
<img src="/posts/9d7fd48f/%E9%AA%8C%E8%AF%81%E5%99%A8%E7%BB%93%E6%9E%9C-%E5%8D%95%E7%9B%AE%E7%9B%B8%E6%9C%BA.png" srcset="/img/loading.gif" lazyload class="" title="验证器结果-单目相机">
</li>
<li>
<p>双目相机结果：</p>
<img src="/posts/9d7fd48f/%E9%AA%8C%E8%AF%81%E5%99%A8%E7%BB%93%E6%9E%9C-%E5%8F%8C%E7%9B%AE%E7%9B%B8%E6%9C%BA.png" srcset="/img/loading.gif" lazyload class="" title="验证器结果-双目相机">
</li>
</ul>
</li>
</ol>
<h2 id="标定IMU">标定IMU</h2>
<h3 id="IMU参数">IMU参数</h3>
<table>
<thead>
<tr>
<th style="text-align:center">Parameter</th>
<th style="text-align:center">YAML element</th>
<th style="text-align:center">Symbol</th>
<th style="text-align:center">Units</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">陀螺仪“白噪声”</td>
<td style="text-align:center"><code>gyr_n</code></td>
<td style="text-align:center"><img src="/posts/9d7fd48f/gyr_n-symbol.svg" srcset="/img/loading.gif" lazyload class="" title="gyr_n-symbol"></td>
<td style="text-align:center"><img src="/posts/9d7fd48f/gyr_n-units.svg" srcset="/img/loading.gif" lazyload class="" title="gyr_n-units"></td>
</tr>
<tr>
<td style="text-align:center">加速度计“白噪声”</td>
<td style="text-align:center"><code>acc_n</code></td>
<td style="text-align:center"><img src="/posts/9d7fd48f/acc_n-symbol.svg" srcset="/img/loading.gif" lazyload class="" title="acc_n-symbol"></td>
<td style="text-align:center"><img src="/posts/9d7fd48f/acc_n-unites.svg" srcset="/img/loading.gif" lazyload class="" title="acc_n-unites"></td>
</tr>
<tr>
<td style="text-align:center">陀螺仪“偏置不稳定”</td>
<td style="text-align:center"><code>gyr_w</code></td>
<td style="text-align:center"><img src="/posts/9d7fd48f/gyr_w-symbol.svg" srcset="/img/loading.gif" lazyload class="" title="gyr_w-symbol"></td>
<td style="text-align:center"><img src="/posts/9d7fd48f/gyr_w-unites.svg" srcset="/img/loading.gif" lazyload class="" title="gyr_w-unites"></td>
</tr>
<tr>
<td style="text-align:center">加速度计“偏置不稳定性”</td>
<td style="text-align:center"><code>acc_w</code></td>
<td style="text-align:center"><img src="/posts/9d7fd48f/acc_w-symbol.svg" srcset="/img/loading.gif" lazyload class="" title="acc_w-symbol"></td>
<td style="text-align:center"><img src="/posts/9d7fd48f/acc_w-unites.svg" srcset="/img/loading.gif" lazyload class="" title="acc_w-unites"></td>
</tr>
</tbody>
</table>
<ul>
<li>白噪声是在 tau=1 时；</li>
<li>偏置不稳定性在最小值附近。</li>
</ul>
<h3 id="旋转外参对齐">旋转外参对齐</h3>
<h4 id="举例">举例</h4>
<p>摘自<a target="_blank" rel="noopener" href="https://github.com/engcang/vins-application?tab=readme-ov-file#-imu-camera-rotational-extrinsic-example">参考链接</a></p>
<ul>
<li>
<p>Between ROS standard body(IMU) and camera.</p>

</li>
<li>
<p>Left view : Between ROS standard body(IMU) and down-pitched (look downward) camera</p>

</li>
</ul>
<h4 id="实物">实物</h4>
<p>为了能够将IMU数据与基于图像的运动估计相结合，需要图像传感器和 IMU 之间的相对位置和方向。下图显示了相机轴和正角速度的旋转方向：</p>
<img src="/posts/9d7fd48f/IMU%E6%96%B9%E5%90%91%E5%AE%9A%E4%B9%89.png" srcset="/img/loading.gif" lazyload class="" title="IMU方向定义">
<p>图像传感器采用标准格式：从背面看相机，X轴指向右侧，Y轴指向上方，Z轴指向镜头。此外，IMU 轴与相机轴对齐。</p>
<p>对于所有三个轴，陀螺仪的旋转都是沿着增加轴逆时针旋转。请注意，这不遵循右手定则。</p>
<h3 id="使用imu-utils标定IMU">使用imu_utils标定IMU</h3>
<ol>
<li>
<p>首先需要静止放置IMU持续两个小时以上，并在此期间记录IMU的数据。</p>
<blockquote>
<p>也可以直接<a href="#%E4%BD%BF%E7%94%A8ROS%E5%91%BD%E4%BB%A4%E8%BF%9B%E8%A1%8C%E5%BD%95%E5%88%B6">使用ROS命令进行录制</a>。</p>
</blockquote>
<ol>
<li>
<p>打开<code>dv-gui</code>，使用其录制功能，具体录制步骤如<a href="#%E5%BD%95%E5%88%B6">录制</a>小节所述。这里使用到的Structure为：</p>
<img src="/posts/9d7fd48f/IMU%E5%BD%95%E5%88%B6%E7%BB%93%E6%9E%84.png" srcset="/img/loading.gif" lazyload class="" title="IMU录制结构">
<blockquote>
<p>当然，你也可以直接使用<code>dv-gui</code>默认的录制结构，这会同时记录事件、图像、IMU和触发数据。经过测试，这样录制1min会大概存储400MB的数据（也有我把图像帧帧率设为了40Hz的原因吧）。而只保留IMU数据的话，是3-4MB/min。且把450MB的aedat4格式文件转为rosbag格式，变成了3.4GB。</p>
</blockquote>
</li>
<li>
<p>（可选）录制结束后，可以使用<code>dv-gui</code>的<a href="#%E5%9B%9E%E6%94%BE">回放</a>功能可视化<code>*.aedat4</code>文件。</p>
</li>
<li>
<p>将<code>*.aedat4</code>文件转化为<code>*.bag</code>文件。<a href="#%E8%BD%AC%E4%B8%BAbag%E5%8C%85%E6%A0%BC%E5%BC%8F">转为bag包格式</a></p>
</li>
</ol>
</li>
<li>
<p>使用imu_utils标定IMU。</p>
<ol>
<li>
<p>在<code>catkin_ws/src/imu_utils/launch</code>文件夹下定义<code>DAVIS346.launch</code>，内容示例：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs xml"> <span class="hljs-tag">&lt;<span class="hljs-name">launch</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">node</span> <span class="hljs-attr">pkg</span>=<span class="hljs-string">&quot;imu_utils&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;imu_an&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;imu_an&quot;</span> <span class="hljs-attr">output</span>=<span class="hljs-string">&quot;screen&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">param</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;imu_topic&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;string&quot;</span> <span class="hljs-attr">value</span>= <span class="hljs-string">&quot;/DAVIS346/imu&quot;</span>/&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">param</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;imu_name&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;string&quot;</span> <span class="hljs-attr">value</span>= <span class="hljs-string">&quot;DAVIS&quot;</span>/&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">param</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;data_save_path&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;string&quot;</span> <span class="hljs-attr">value</span>= <span class="hljs-string">&quot;$(find imu_utils)/data/DAVIS346/&quot;</span>/&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">param</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;max_time_min&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;int&quot;</span> <span class="hljs-attr">value</span>= <span class="hljs-string">&quot;120&quot;</span>/&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">param</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;max_cluster&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;int&quot;</span> <span class="hljs-attr">value</span>= <span class="hljs-string">&quot;100&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">node</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">launch</span>&gt;</span><br></code></pre></td></tr></table></figure>
<ul>
<li>
<p><code>imu_topic</code>可以通过<code>rosbag info xxx.bag</code>命令来查看。</p>
</li>
<li>
<p><code>imu_name</code>自定义即可。</p>
</li>
<li>
<p><code>data_save_path</code>：程序会生成很多文件，因此建议在<code>catkin_ws/src/imu_utils/data</code>目录下新建文件夹。且需要提前新建文件夹。</p>
</li>
<li>
<p><code>max_time_min</code>以分钟为单位，至少要大于120分钟，小于<code>*.bag</code>文件的录制时间（可以通过<code>rosbag info xxx.bag</code>命令来查看）。</p>
</li>
<li>
<p><code>max_cluster</code>的主要作用是控制在计算陀螺仪和加速度计的Allan方差时，用于分割数据的时间段的数量。</p>
<blockquote>
<p><code>max_cluster</code>的值取决于您的具体需求和数据集的大小。这个值决定了在计算陀螺仪和加速度计的Allan方差时，用于分割数据的时间段的数量。如果您的数据集非常大，您可能需要更多的时间段来更精确地计算Allan方差。然而，如果您的数据集较小，设置一个较大的<code>max_cluster</code>值可能会导致计算过程中的错误，因为每个时间段可能没有足够的数据。</p>
<p>一般来说，您可以从一个较小的值开始（例如10或100），然后根据需要逐渐增加。您也可以通过实验来确定最佳的<code>max_cluster</code>值，例如，您可以尝试不同的<code>max_cluster</code>值，然后选择使得Allan方差计算结果最稳定的值。</p>
<p>请注意，设置<code>max_cluster</code>的值并不是一个精确的科学，而是需要根据您的具体情况进行调整。</p>
</blockquote>
</li>
</ul>
</li>
<li>
<p>执行标定：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> catkin_ws<br><span class="hljs-built_in">source</span> ./devel/setup.zsh &amp;&amp; roslaunch imu_utils DAVIS346.launch<br>rosbag play /yourfolder/xxx.bag<br><span class="hljs-comment"># rosbag play -r 200 /yourfolder/xxx.bag  # 使用200倍率加速播放bag包。加速播放后的结果与不加速的结果存在些许差异，不加速的结果要更准确些？</span><br></code></pre></td></tr></table></figure>
<blockquote>
<p>在bag包播放期间会一直显示<code>wait for imu data</code>，不用担心。bag包播放完成后会自动开始计算。</p>
</blockquote>
</li>
<li>
<p>程序执行完后，会在你<code>*.launch</code>中定义的<code>data_save_path</code>下生成很多<code>*.txt</code>文件，这些文件是按照<code>max_cluster</code>分段计算的数据。最终的结果文件是<code>DAVIS1043_imu_param.yaml</code>，内容示例：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-string">%YAML:1.0</span><br><span class="hljs-meta">---</span><br><span class="hljs-attr">type:</span> <span class="hljs-string">IMU</span><br><span class="hljs-attr">name:</span> <span class="hljs-string">DAVIS1043</span><br><span class="hljs-attr">Gyr:</span><br>   <span class="hljs-attr">unit:</span> <span class="hljs-string">&quot; rad/s&quot;</span><br>   <span class="hljs-attr">avg-axis:</span><br>      <span class="hljs-attr">gyr_n:</span> <span class="hljs-number">3.5384520281682686e-03</span><br>      <span class="hljs-attr">gyr_w:</span> <span class="hljs-number">4.0272140518453810e-05</span><br>   <span class="hljs-attr">x-axis:</span><br>      <span class="hljs-attr">gyr_n:</span> <span class="hljs-number">3.4408169287573438e-03</span><br>      <span class="hljs-attr">gyr_w:</span> <span class="hljs-number">3.2414703166302208e-05</span><br>   <span class="hljs-attr">y-axis:</span><br>      <span class="hljs-attr">gyr_n:</span> <span class="hljs-number">3.9601252212234988e-03</span><br>      <span class="hljs-attr">gyr_w:</span> <span class="hljs-number">3.8751159163201969e-05</span><br>   <span class="hljs-attr">z-axis:</span><br>      <span class="hljs-attr">gyr_n:</span> <span class="hljs-number">3.2144139345239632e-03</span><br>      <span class="hljs-attr">gyr_w:</span> <span class="hljs-number">4.9650559225857252e-05</span><br><span class="hljs-attr">Acc:</span><br>   <span class="hljs-attr">unit:</span> <span class="hljs-string">&quot; m/s^2&quot;</span><br>   <span class="hljs-attr">avg-axis:</span><br>      <span class="hljs-attr">acc_n:</span> <span class="hljs-number">4.3575299381088319e-02</span><br>      <span class="hljs-attr">acc_w:</span> <span class="hljs-number">6.5383798561067846e-04</span><br>   <span class="hljs-attr">x-axis:</span><br>      <span class="hljs-attr">acc_n:</span> <span class="hljs-number">3.7100312938203754e-02</span><br>      <span class="hljs-attr">acc_w:</span> <span class="hljs-number">6.5120320157541472e-04</span><br>   <span class="hljs-attr">y-axis:</span><br>      <span class="hljs-attr">acc_n:</span> <span class="hljs-number">3.6796771423116353e-02</span><br>      <span class="hljs-attr">acc_w:</span> <span class="hljs-number">5.6544592980328930e-04</span><br>   <span class="hljs-attr">z-axis:</span><br>      <span class="hljs-attr">acc_n:</span> <span class="hljs-number">5.6828813781944834e-02</span><br>      <span class="hljs-attr">acc_w:</span> <span class="hljs-number">7.4486482545333115e-04</span><br></code></pre></td></tr></table></figure>
</li>
<li>
<p>（可选）后续在使用Kalibr进行视惯联合标定时。需要将IMU数据转换成其规定的<a target="_blank" rel="noopener" href="https://github.com/ethz-asl/kalibr/wiki/yaml-formats">文件格式</a>，内容示例：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment">#Accelerometers</span><br><span class="hljs-attr">accelerometer_noise_density:</span> <span class="hljs-number">4.3575299381088319e-02</span>   <span class="hljs-comment">#Noise density (continuous-time)</span><br><span class="hljs-attr">accelerometer_random_walk:</span>   <span class="hljs-number">6.5383798561067846e-04</span>   <span class="hljs-comment">#Bias random walk</span><br><br><span class="hljs-comment">#Gyroscopes</span><br><span class="hljs-attr">gyroscope_noise_density:</span>     <span class="hljs-number">3.5384520281682686e-03</span>   <span class="hljs-comment">#Noise density (continuous-time)</span><br><span class="hljs-attr">gyroscope_random_walk:</span>       <span class="hljs-number">4.0272140518453810e-05</span>   <span class="hljs-comment">#Bias random walk</span><br><br><span class="hljs-attr">rostopic:</span>                    <span class="hljs-string">/DAVIS346/imu</span>      <span class="hljs-comment">#the IMU ROS topic</span><br><span class="hljs-attr">update_rate:</span>                 <span class="hljs-number">1000.0</span>      <span class="hljs-comment">#Hz (for discretization of the values above) 后续根据实际ROS包的速率进行修改</span><br></code></pre></td></tr></table></figure>
</li>
<li>
<p>（可选）在<a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=BtzmsuJemgI">官方视频教程-2</a>的“IMU noise recovery“小节，作者将<code>noise_density</code>放大5倍，将<code>random_walk</code>放大10倍，理由是：为了考虑未完全建模的额外噪声。特别是如果您将此传感器安装在移动机器人上，则会产生额外的振动和温度影响。</p>
<blockquote>
<p>直接在 <a target="_blank" rel="noopener" href="https://www.google.com">https://www.google.com</a> 输入 “4.3575299381088319e-02 * 5” 即可进行计算。</p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment">#Accelerometers</span><br><span class="hljs-attr">accelerometer_noise_density:</span> <span class="hljs-number">0.2178764969</span>   <span class="hljs-comment">#Noise density (continuous-time) * 5</span><br><span class="hljs-attr">accelerometer_random_walk:</span>   <span class="hljs-number">6.5383798561067846e-03</span>   <span class="hljs-comment">#Bias random walk * 10</span><br><br><span class="hljs-comment">#Gyroscopes</span><br><span class="hljs-attr">gyroscope_noise_density:</span>     <span class="hljs-number">0.01769226014</span>   <span class="hljs-comment">#Noise density (continuous-time) * 5</span><br><span class="hljs-attr">gyroscope_random_walk:</span>       <span class="hljs-number">4.0272140518453810e-04</span>   <span class="hljs-comment">#Bias random walk * 10</span><br><br><span class="hljs-attr">rostopic:</span>                    <span class="hljs-string">/DAVIS346/imu</span>      <span class="hljs-comment">#the IMU ROS topic</span><br><span class="hljs-attr">update_rate:</span>                 <span class="hljs-number">1000.0</span>      <span class="hljs-comment">#Hz (for discretization of the values above) 后续根据实际ROS包的速率进行修改</span><br></code></pre></td></tr></table></figure>
</li>
</ol>
</li>
</ol>
<h2 id="视惯联合标定">视惯联合标定</h2>
<h3 id="使用Kalibr进行视惯联合标定">使用Kalibr进行视惯联合标定</h3>
<blockquote>
<p>在视觉惯性联合标定之前，需要先标定相机<a href="#%E4%BD%BF%E7%94%A8Kalibr%E6%A0%87%E5%AE%9A%E7%9B%B8%E6%9C%BA%E5%86%85%E5%8F%82">内参</a>和<a href="#%E4%BD%BF%E7%94%A8imu_utils%E6%A0%87%E5%AE%9AIMU">IMU</a>。</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?app=desktop&amp;v=puNXsnrYWTY">官方视频教程-1</a>：图像帧帧率20Hz，IMU帧率200Hz。相机实操+程序运行。</p>
<p><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=BtzmsuJemgI">官方视频教程-2</a>：图像帧帧率30Hz，IMU帧率400Hz。原理讲解+程序运行。</p>
<p><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=rBT5O5TEOV4">官方视频教程-3</a>：图像帧帧率30Hz，IMU帧率200Hz。原理讲解+相机实操+程序运行。</p>
<ol>
<li>
<p>准备标定板。推荐使用<a target="_blank" rel="noopener" href="https://github.com/ethz-asl/kalibr/wiki/downloads">Aprilgrid 6x6 0.8x0.8 m (A0 page)</a>，配置文件<a target="_blank" rel="noopener" href="https://github.com/ethz-asl/kalibr/wiki/downloads">下载链接</a>。</p>
<blockquote>
<p>如果您使用具有对称性的校准目标（棋盘格、圆网格），则必须避免可能导致目标姿态估计翻转的移动。建议使用 Aprilgrid 来完全避免此问题。</p>
</blockquote>
<ol>
<li>
<p>使用A0纸打印Aprilgrid，如果没有A0大小的纸，将标定板缩放到A4大小打印出来也行？</p>
<blockquote>
<p>在最小校准目标周围保留白色边框，一个网格元素的大小（否则在某些光照条件下检测可能不成功）。</p>
</blockquote>
</li>
<li>
<p>编写标定板的配置文件，内容示例：</p>
<p><code>april_A0.yaml</code>：</p>
<img src="/posts/9d7fd48f/%E6%B5%8B%E9%87%8F%E6%A0%87%E5%AE%9A%E6%9D%BF%E7%9A%84tagSize.png" srcset="/img/loading.gif" lazyload class="" title="测量标定板的tagSize">
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">target_type:</span> <span class="hljs-string">&#x27;aprilgrid&#x27;</span> <span class="hljs-comment">#gridtype</span><br><span class="hljs-comment"># 内侧角点的数量，不是格子数量</span><br><span class="hljs-attr">tagCols:</span> <span class="hljs-number">6</span>               <span class="hljs-comment">#number of apriltags</span><br><span class="hljs-attr">tagRows:</span> <span class="hljs-number">6</span>               <span class="hljs-comment">#number of apriltags</span><br><span class="hljs-attr">tagSize:</span> <span class="hljs-number">0.088</span>           <span class="hljs-comment">#size of apriltag, edge to edge [m]  上面截图中为 0.02m</span><br><span class="hljs-attr">tagSpacing:</span> <span class="hljs-number">0.3</span>          <span class="hljs-comment">#ratio of space between tags to tagSize</span><br>                         <span class="hljs-comment">#example: tagSize=2m, spacing=0.5m --&gt; tagSpacing=0.25[-]</span><br><span class="hljs-attr">codeOffset:</span> <span class="hljs-number">0</span>            <span class="hljs-comment">#code offset for the first tag in the aprilboard</span><br></code></pre></td></tr></table></figure>
<p><code>april_A4.yaml</code>：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">target_type:</span> <span class="hljs-string">&#x27;aprilgrid&#x27;</span> <span class="hljs-comment">#gridtype</span><br><span class="hljs-attr">tagCols:</span> <span class="hljs-number">6</span>               <span class="hljs-comment">#number of apriltags</span><br><span class="hljs-attr">tagRows:</span> <span class="hljs-number">6</span>               <span class="hljs-comment">#number of apriltags</span><br><span class="hljs-attr">tagSize:</span> <span class="hljs-number">0.024</span>           <span class="hljs-comment">#size of apriltag, edge to edge [m] 上面截图中为 0.02m</span><br><span class="hljs-attr">tagSpacing:</span> <span class="hljs-number">0.3125</span>          <span class="hljs-comment">#ratio of space between tags to tagSize</span><br><span class="hljs-attr">codeOffset:</span> <span class="hljs-number">0</span>            <span class="hljs-comment">#code offset for the first tag in the aprilboard</span><br></code></pre></td></tr></table></figure>
<blockquote>
<p>大多数打印机会在打印过程中缩放目标。确保重新测量重要尺寸并相应调整目标配置。</p>
</blockquote>
</li>
</ol>
</li>
<li>
<p>录制rosbag包。使用<code>dv-gui</code><a href="#%E5%BD%95%E5%88%B6">录制</a>生成<code>*.aedat4</code>文件，然后将其<a href="#%E8%BD%AC%E4%B8%BAbag%E5%8C%85%E6%A0%BC%E5%BC%8F">转化</a>为<code>*.bag</code>文件；也可以直接<a href="#%E4%BD%BF%E7%94%A8ROS%E5%91%BD%E4%BB%A4%E8%BF%9B%E8%A1%8C%E5%BD%95%E5%88%B6">使用ROS命令进行录制</a>。</p>
<blockquote>
<p>可以直接使用<a href="#%E4%BD%BF%E7%94%A8Kalibr%E6%A0%87%E5%AE%9A%E7%9B%B8%E6%9C%BA%E5%86%85%E5%8F%82">使用Kalibr标定相机内参</a>里录制的bag包。</p>
</blockquote>
<p>录制要求：</p>
<ul>
<li>使用 20-30 Hz 的相机速率和 200-500 Hz 的 IMU 速率获得了良好的结果。</li>
<li>确保您的传感器处于焦点。<a href="#%E4%BD%BF%E7%94%A8DV%E8%BF%9B%E8%A1%8C%E5%AF%B9%E7%84%A6">使用DV进行对焦</a>、<a href="#%E4%BD%BF%E7%94%A8Kalibr%E8%BF%9B%E8%A1%8C%E5%AF%B9%E7%84%A6">使用Kalibr进行对焦</a></li>
<li>避免震动，尤其是在拿起传感器的开始/结束时。</li>
<li>本次标定中标定目标（板）是固定的，相机-imu系统移动到目标前面并激励所有IMU轴（旋转轴和加速轴）。</li>
<li>需要至少进行一次平移运动以及两度方向变化，建议尽可能多地改变方向，以确保后续校准过程收敛。</li>
<li>确保校准目标尽可能平坦。最好的方法是将其粘在硬板上，例如铝或丙烯酸玻璃。</li>
<li>确保可以从不同方向、距离且大部分位于图像中心看到校准板。您应该以平滑、不急促的运动移动，其轨迹应同时激发尽可能多的定向和平移方向。
<ul>
<li>收集数据时需要避免退化方向（例如平面运动）。以非恒定加速度激发两轴运动至关重要。</li>
<li>争取把标定板晃动到过相机像素平面的每个地方。</li>
</ul>
</li>
<li>保持低运动模糊：低曝光时间、低快门时间、照明良好。</li>
<li>确保同一时钟内的低抖动时间戳。</li>
<li>30-60 秒的数据集通常足以进行校准。</li>
<li>相机不能离标定板太远，太远执行标定过程中就检测不到角点了。</li>
<li>运动幅度尽量大一点，保证激励IMU。</li>
</ul>
<p>实施步骤：</p>
<blockquote>
<ul>
<li>注意运动平滑，速度不要太快。</li>
<li>标定板始终在相机视野内。</li>
<li>持续1分钟以上以获得足够的数据。</li>
</ul>
</blockquote>
<ol>
<li>相机纵向俯仰绕标定板来回旋转3次。</li>
<li>相机横向偏航绕标定板来回旋转3次。</li>
<li>相机自身（对准标定板）上下旋转3次。</li>
<li>相机左右水平来回运动3次。</li>
<li>相机上下水平来回运动3次。</li>
<li>相机前后水平来回运动3次。</li>
<li>相机随机运动。</li>
</ol>
</li>
<li>
<p>执行标定。</p>
<p>必选参数：</p>
<ul>
<li>
<p><code>--bag filename.bag</code>：包含图像和 IMU 数据的 ROS 包</p>
</li>
<li>
<p><code>--cam camchain.yaml</code>：相机系统的内在和外在标定参数。<a href="#%E4%BD%BF%E7%94%A8Kalibr%E6%A0%87%E5%AE%9A%E7%9B%B8%E6%9C%BA%E5%86%85%E5%8F%82">使用Kalibr标定相机内参</a>的结果文件之一</p>
</li>
<li>
<p><code>--imu imu.yaml</code>：包含 IMU 统计信息和 IMU 主题。<a href="#%E4%BD%BF%E7%94%A8imu_utils%E6%A0%87%E5%AE%9AIMU">使用imu_utils标定IMU</a>的结果文件</p>
</li>
<li>
<p><code>--target target.yaml</code>：标定目标（板）的配置文件</p>
</li>
</ul>
<p>可选参数：</p>
<ul>
<li><code>--show-extraction</code>：可视化校准目标提取过程。这可能有助于发现目标配置和提取的问题。</li>
</ul>
<p>运行示例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># kalibr_calibrate_imu_camera --bag [filename.bag] --cam [camchain.yaml] --imu [imu.yaml] --target [target.yaml]  # 时间校准默认打开，可以使用 --no-time-calibration 参数禁用。</span><br><br><span class="hljs-built_in">cd</span> yourfloder/kalibr_workspace<br>roscore<br><span class="hljs-built_in">source</span> ./devel/setup.bash &amp;&amp; rosrun kalibr kalibr_calibrate_imu_camera \<br>	--target april_6x6.yaml \<br>	--imu imu_adis16448.yaml \  <span class="hljs-comment"># 里面指定了使用的IMU主题</span><br>	--imu-models calibrated \<br>	--cam cam_april-camchain.yaml \  <span class="hljs-comment"># 里面指定了使用的image主题</span><br>	--bag imu_april.bag \<br>	<span class="hljs-comment"># --bag-freq 10.0 \  # 提取特征的频率/Hz。根据指定频率向下采样，删除多余的图片。</span><br> 	--bag-from-to 10 100 \  <span class="hljs-comment"># 处理bag中10-100秒的数据</span><br> 	--show-extraction<br></code></pre></td></tr></table></figure>
<blockquote>
<p>使用 help 参数可以获得有关选项的更多信息：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">kalibr_calibrate_imu_camera --h<br></code></pre></td></tr></table></figure>
</blockquote>
</li>
<li>
<p>输出。校准将在<code>*.bag</code>路径下产生以下输出文件：</p>
<ul>
<li>
<p><code>report-imucam-%BAGNAME%.pdf</code>：PDF 格式的报告。包含文档的所有图。</p>
<blockquote>
<p>应确保检查 IMU 时间戳 DT。例如，以下 IMU 具有不正确的时间戳，其中 IMU 突发以 1 毫秒的速率发送，间隔为 6 毫秒：</p>
<img src="/posts/9d7fd48f/IMU%E8%AF%AF%E5%B7%AE%E7%A4%BA%E4%BE%8B-1.png" srcset="/img/loading.gif" lazyload class="" title="IMU误差示例-1">
<p>如果你有这个，那么你的硬件很可能会被搞乱，并且你会遇到校准问题。您将需要纠正时间戳问题。</p>
<p>一个“好的”时间戳应该具有固定的速率（除了传感器下降），例如读数之间有固定的 5 毫秒（200Hz）的时间戳：</p>
<img src="/posts/9d7fd48f/IMU%E8%AF%AF%E5%B7%AE%E7%A4%BA%E4%BE%8B-2.png" srcset="/img/loading.gif" lazyload class="" title="IMU误差示例-2">
<p>而其他 IMU 可能会出现“抖动”，其中交替读数在固定频率附近有小误差。这并不是什么大问题，但却是误差的根源（不像第一个示例那么糟糕）：</p>
<img src="/posts/9d7fd48f/IMU%E8%AF%AF%E5%B7%AE%E7%A4%BA%E4%BE%8B-3.png" srcset="/img/loading.gif" lazyload class="" title="IMU误差示例-3">
</blockquote>
</li>
<li>
<p><code>results-imucam-%BAGNAME%.txt</code>：结果摘要作为文本文件。</p>
</li>
<li>
<p><code>camchain-imucam-%BAGNAME%.yaml</code>：YAML 格式的结果。该文件基于输入 camchain.yaml，并为所有相机添加了与 IMU 相关的转换（以及可选的时移）。<a href="#Kalibr%E7%9A%84%E8%BE%93%E5%87%BA%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F">Kalibr的输出文件格式</a></p>
</li>
</ul>
</li>
<li>
<p>结果检验。</p>
<ul>
<li>
<p><code>report-imucam-%BAGNAME%.pdf</code>报告第1页的重投影误差（Reprojection error） &lt; 0.2-0.5 。</p>
</li>
<li>
<p>确保预测的加速度和角速度符合 IMU 测量值。您需要确保适合惯性读数的样条线已正确安装。您的加速度计和陀螺仪误差在 3-sigma 范围内（如果不在范围内，则您的 IMU 噪声或数据集不正确）。如果它们确实超出范围，那么您的轨迹过于动态，或者您的噪声值不好。使用手动测量值来合理检查您的最终旋转和平移。</p>
<blockquote>
<p>下图的边界代表的是 3-sigma 范围。</p>
</blockquote>
<img src="/posts/9d7fd48f/%E5%9C%88%E5%86%85%E6%98%AF3-sigma%E8%8C%83%E5%9B%B4.png" srcset="/img/loading.gif" lazyload class="" title="圈内是3-sigma范围">
<img src="/posts/9d7fd48f/kalibr_accel_err.png" srcset="/img/loading.gif" lazyload class="" title="kalibr_accel_err">
</li>
<li>
<p>检查结果图，如良好的校准具有小于 &lt; 0.2-0.5 像素重投影误差。如果您计划对相机进行在线校准，则可能可以接受较大的值（例如 1 像素），但始终首选更准确的离线校准。</p>
<img src="/posts/9d7fd48f/%E9%87%8D%E6%8A%95%E5%BD%B1%E8%AF%AF%E5%B7%AE%E7%A4%BA%E4%BE%8B.png" srcset="/img/loading.gif" lazyload class="" title="重投影误差示例">
</li>
</ul>
</li>
</ol>
<h3 id="使用DV进行视惯联合标定（TODO）">使用DV进行视惯联合标定（TODO）</h3>
<p><a target="_blank" rel="noopener" href="https://docs.inivation.com/software/software-advanced-usage/camera-calibration.html">https://docs.inivation.com/software/software-advanced-usage/camera-calibration.html</a></p>
<p><a target="_blank" rel="noopener" href="https://inivation.com/developer/tutorials/">https://inivation.com/developer/tutorials/</a></p>
<h2 id="Kalibr的输出文件格式">Kalibr的输出文件格式</h2>
<p><code>camchain.yaml</code>文件中存储了相机内在和外在参数的校准以及IMU相对于相机的空间和时间校准参数。每个相机都有以下参数：</p>
<ul>
<li>
<p><strong>camera_model</strong> 相机型号<br>
camera projection type (pinhole / omni) 相机投影类型（针孔/全向）</p>
</li>
<li>
<p>**intrinsics **内参<br>
vector containing the intrinsic parameters for the given projection type. elements are as follows:</p>
<p>包含给定投影类型的内参的向量。元素如下：</p>
<p>pinhole: [fu fv pu pv]<br>
omni: [xi fu fv pu pv]<br>
ds: [xi alpha fu fv pu pv]<br>
eucm: [alpha beta fu fv pu pv]<br>
see <a target="_blank" rel="noopener" href="https://github.com/ethz-asl/kalibr/wiki/supported-models">Supported models</a> for more information</p>
</li>
<li>
<p>**distortion_model **畸变模型<br>
lens distortion type (radtan / equidistant) 镜头畸变类型（radtan/等距）</p>
</li>
<li>
<p><strong>distortion_coeffs</strong> 畸变系数<br>
parameter vector for the distortion model 畸变模型的参数向量<br>
see <a target="_blank" rel="noopener" href="https://github.com/ethz-asl/kalibr/wiki/supported-models">Supported models</a> for more information</p>
<p>radial-tangential (radtan)(<em>distortion_coeffs</em>: [k1 k2 r1 r2])</p>
<p>equidistant (equi)(distortion_coeffs: [k1 k2 k3 k4])</p>
<p>fov (fov)(distortion_coeffs: [w])</p>
<p>none (none)(distortion_coeffs: [])</p>
</li>
<li>
<p><strong>T_cn_cnm1</strong><br>
camera extrinsic transformation, always with respect to the last camera in the chain<br>
(e.g. cam1: T_cn_cnm1 = T_c1_c0, takes cam0 to cam1 coordinates)</p>
<p>相机外部变换，始终相对于链中的最后一个相机</p>
<p>（例如 cam1: T_cn_cnm1 = T_c1_c0，将cam0坐标转换为cam1坐标）</p>
</li>
<li>
<p><strong>T_cam_imu</strong><br>
IMU extrinsics: transformation from IMU to camera coordinates (T_c_i) 从 IMU 到相机坐标的转换</p>
</li>
<li>
<p><strong>timeshift_cam_imu</strong><br>
timeshift between camera and IMU timestamps in seconds (t_imu = t_cam + shift) 相机和 IMU 时间戳之间的时移（以秒为单位）</p>
</li>
<li>
<p><strong>rostopic</strong><br>
topic of the camera's image stream 相机图像流的主题</p>
</li>
<li>
<p><strong>resolution</strong><br>
camera resolution [width,height] 相机分辨率[宽度，高度]</p>
</li>
</ul>
<p>内容示例：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">cam0:</span><br>  <span class="hljs-attr">camera_model:</span> <span class="hljs-string">pinhole</span><br>  <span class="hljs-attr">intrinsics:</span> [<span class="hljs-number">461.629</span>, <span class="hljs-number">460.152</span>, <span class="hljs-number">362.680</span>, <span class="hljs-number">246.049</span>]<br>  <span class="hljs-attr">distortion_model:</span> <span class="hljs-string">radtan</span><br>  <span class="hljs-attr">distortion_coeffs:</span> [<span class="hljs-number">-0.27695497</span>, <span class="hljs-number">0.06712482</span>, <span class="hljs-number">0.00087538</span>, <span class="hljs-number">0.00011556</span>]<br>  <span class="hljs-attr">T_cam_imu:</span><br>  <span class="hljs-bullet">-</span> [<span class="hljs-number">0.01779318</span>, <span class="hljs-number">0.99967549</span>,<span class="hljs-number">-0.01822936</span>, <span class="hljs-number">0.07008565</span>]<br>  <span class="hljs-bullet">-</span> [<span class="hljs-number">-0.9998017</span>, <span class="hljs-number">0.01795239</span>, <span class="hljs-number">0.00860714</span>,<span class="hljs-number">-0.01771023</span>]<br>  <span class="hljs-bullet">-</span> [<span class="hljs-number">0.00893160</span>, <span class="hljs-number">0.01807260</span>, <span class="hljs-number">0.99979678</span>, <span class="hljs-number">0.00399246</span>]<br>  <span class="hljs-bullet">-</span> [<span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>]<br>  <span class="hljs-attr">timeshift_cam_imu:</span> <span class="hljs-number">-8.121e-05</span><br>  <span class="hljs-attr">rostopic:</span> <span class="hljs-string">/cam0/image_raw</span><br>  <span class="hljs-attr">resolution:</span> [<span class="hljs-number">752</span>, <span class="hljs-number">480</span>]<br><span class="hljs-attr">cam1:</span><br>  <span class="hljs-attr">camera_model:</span> <span class="hljs-string">omni</span><br>  <span class="hljs-attr">intrinsics:</span> [<span class="hljs-number">0.80065662</span>, <span class="hljs-number">833.006</span>, <span class="hljs-number">830.345</span>, <span class="hljs-number">373.850</span>, <span class="hljs-number">253.749</span>]<br>  <span class="hljs-attr">distortion_model:</span> <span class="hljs-string">radtan</span><br>  <span class="hljs-attr">distortion_coeffs:</span> [<span class="hljs-number">-0.33518750</span>, <span class="hljs-number">0.13211436</span>, <span class="hljs-number">0.00055967</span>, <span class="hljs-number">0.00057686</span>]<br>  <span class="hljs-attr">T_cn_cnm1:</span><br>  <span class="hljs-bullet">-</span> [ <span class="hljs-number">0.99998854</span>, <span class="hljs-number">0.00216014</span>, <span class="hljs-number">0.00427195</span>,<span class="hljs-number">-0.11003785</span>]<br>  <span class="hljs-bullet">-</span> [<span class="hljs-number">-0.00221074</span>, <span class="hljs-number">0.99992702</span>, <span class="hljs-number">0.01187697</span>, <span class="hljs-number">0.00045792</span>]<br>  <span class="hljs-bullet">-</span> [<span class="hljs-number">-0.00424598</span>,<span class="hljs-number">-0.01188627</span>, <span class="hljs-number">0.99992034</span>,<span class="hljs-number">-0.00064487</span>]<br>  <span class="hljs-bullet">-</span> [<span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>]<br>  <span class="hljs-attr">T_cam_imu:</span><br>  <span class="hljs-bullet">-</span> [ <span class="hljs-number">0.01567142</span>, <span class="hljs-number">0.99978002</span>,<span class="hljs-number">-0.01393948</span>,<span class="hljs-number">-0.03997419</span>]<br>  <span class="hljs-bullet">-</span> [<span class="hljs-number">-0.99966203</span>, <span class="hljs-number">0.01595569</span>, <span class="hljs-number">0.02052137</span>,<span class="hljs-number">-0.01735854</span>]<br>  <span class="hljs-bullet">-</span> [ <span class="hljs-number">0.02073927</span>, <span class="hljs-number">0.01361317</span>, <span class="hljs-number">0.99969223</span>, <span class="hljs-number">0.00326019</span>]<br>  <span class="hljs-bullet">-</span> [<span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>]<br>  <span class="hljs-attr">timeshift_cam_imu:</span> <span class="hljs-number">-8.681e-05</span><br>  <span class="hljs-attr">rostopic:</span> <span class="hljs-string">/cam1/image_raw</span><br>  <span class="hljs-attr">resolution:</span> [<span class="hljs-number">752</span>, <span class="hljs-number">480</span>]<br></code></pre></td></tr></table></figure>
<h2 id="其它标定方法">其它标定方法</h2>
<p>标定事件相机内参：</p>
<ul>
<li><a target="_blank" rel="noopener" href="http://wiki.ros.org/camera_calibration/Tutorials/MonocularCalibration">http://wiki.ros.org/camera_calibration/Tutorials/MonocularCalibration</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/uzh-rpg/e2calib">https://github.com/uzh-rpg/e2calib</a></li>
</ul>
<p>标定IMU：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/rpng/kalibr_allan">https://github.com/rpng/kalibr_allan</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/ori-drs/allan_variance_ros%E3%80%81https://docs.openvins.com/gs-calibration.html">https://github.com/ori-drs/allan_variance_ros、https://docs.openvins.com/gs-calibration.html</a></li>
</ul>
<h2 id="参考链接">参考链接</h2>
<ul>
<li><a target="_blank" rel="noopener" href="https://docs.inivation.com">https://docs.inivation.com</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/ethz-asl/kalibr/wiki">https://github.com/ethz-asl/kalibr/wiki</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.openvins.com/gs-calibration.html">https://docs.openvins.com/gs-calibration.html</a></li>
</ul>
<h1 id="录制、回放与转为bag包格式">录制、回放与转为bag包格式</h1>
<h2 id="使用dv-gui进行录制与回放">使用dv-gui进行录制与回放</h2>
<h3 id="录制">录制</h3>
<img src="/posts/9d7fd48f/record-ui.png" srcset="/img/loading.gif" lazyload class="" title="UI element positions for recording">
<ol>
<li>在 DV 左侧栏中选择“<em>Record</em>”配置。当前配置将替换为标准录制配置（可改为自定义配置，用来只录制自己感兴趣的数据）。默认记录配置记录来自连接的 DVS / Davis 摄像机的所有事件、帧、imu 和触发数据。</li>
<li>选择中间顶部的“<em>Output</em>”选项卡以可视化实时录制。</li>
<li>从右侧“<em>Capture</em>”设置中的“<em>Input Selection</em>”下选择要记录的摄像机输入。</li>
<li>（可选）在右侧Recorder-DIRECTORY下自定义文件保存路径。</li>
<li>单击红色圆圈按钮即可开始录制。所有数据均以 aedat 4.0 格式记录。</li>
</ol>
<h3 id="回放">回放</h3>
<p>如果您想要可视化 AEDAT4 格式的播放数据：</p>
<ol>
<li>请在 DV 左侧栏中选择“<em>Visualize</em>”配置。</li>
<li>从右侧“<em>Capture</em>”设置中的“<em>Input Selection</em>”下选择“<em>File</em>”选项，然后选择要打开的文件。</li>
<li>一旦您选择了正确的文件，可视化就会开始。</li>
</ol>
<h2 id="转为bag包格式">转为bag包格式</h2>
<p>此处使用的是<code>dv-ros</code>中提供的功能包<code>dv_ros_aedat4</code>，因此，需要提前<a href="#dv-ros">编译</a>好<code>dv-ros</code>。</p>
<p>根据<code>dv_ros_aedat4</code>里<code>README.md</code>的说明，可选参数包括：</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs txt">Usage: ./devel/lib/dv_ros_aedat4/convert_aedat4 [OPTIONS]<br><br>Options:<br>  -h,--help                   Print this help message and exit<br>  -i,--input TEXT:FILE REQUIRED 必需项，yourfolder/xxx.aedat4<br>                              Input aedat4 file<br>  -o,--output TEXT            Output aedat4 file 如果不填，默认在输入路径生成同名的.bag文件<br>  -n,--namespace [/recording]<br>                              Topic namespace<br>  -f,--force-overwrite 如果输出路径存在重命文件，则强制覆盖，不再生成提示<br>  -v,--verbose 显示文件转换进度<br></code></pre></td></tr></table></figure>
<p>执行方法举例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> yourfolder/catkin_ws<br>./devel/lib/dv_ros_aedat4/convert_aedat4 -i yourfile/xxx.aedat4 -n /DAVIS346 -f -v<br></code></pre></td></tr></table></figure>
<blockquote>
<p>这里面用到的路径有相对路径和绝对路径，看你的终端处在哪个文件夹里了。</p>
</blockquote>
<blockquote>
<p>如果运行时报错：The following argument was not expected: /DAVIS346。</p>
<p>则把<code>dv-ros/dv_ros_aedat4/src/convert_aedat4.cpp</code>中第43行改为：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">// app.add_flag(&quot;-n,--namespace&quot;, topicNamespace, &quot;Topic namespace&quot;);</span><br>app.<span class="hljs-built_in">add_option</span>(<span class="hljs-string">&quot;-n,--namespace&quot;</span>, topicNamespace, <span class="hljs-string">&quot;Topic namespace&quot;</span>);<br></code></pre></td></tr></table></figure>
<p>即<code>-n</code>参数应该读入的是字符串，而不是一个标志。</p>
<p>然后，重新编译<code>dv_ros_aedat4</code>功能包即可：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">catkin build dv_ros_aedat4<br></code></pre></td></tr></table></figure>
</blockquote>
<p>转化完成后，</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">rosbag info xxx.bag  <span class="hljs-comment"># 命令来查看转化成的bag包的信息</span><br><br>roscore<br>rostopic list  <span class="hljs-comment"># 查看消息列表</span><br>rostopic <span class="hljs-built_in">echo</span> /DAVIS346/imu  <span class="hljs-comment"># 查看IMU数据</span><br>rostopic hz /DAVIS346/imu  <span class="hljs-comment"># 查看IMU的频率</span><br></code></pre></td></tr></table></figure>
<p>更多关于rosbag的ROS命令：<a href="https://zeyulong.com/posts/c4541b88/#rosbag">ROS知识-rosbag</a></p>
<h2 id="使用ROS命令进行录制">使用ROS命令进行录制</h2>
<p>也可以直接使用<code>rosbag record TOPIC1 [TOPIC2 TOPIC3 ...]</code>命令订阅主题并写入一个<code>*.bag</code>文件，具体的<a href="https://zeyulong.com/posts/c4541b88/#rosbag">参数说明</a>。</p>
<p>具体步骤为：</p>
<ol>
<li>使用<a href="#rpg_dvs_ros">rpg_dvs_ros</a>或<a href="#dv-ros">dv-ros</a>进行可视化。期间可以通过修改<code>*.launch</code>文件的方式自定义<code>topic</code>名称。</li>
<li>使用<code>rostopic list</code>命令查询当前正在使用的<code>topic</code>名称。</li>
<li>使用<code>rosbag record TOPIC1 [TOPIC2 TOPIC3 ...]</code>命令订阅主题并写入一个<code>*.bag</code>文件。</li>
</ol>
<h1 id="双目">双目</h1>
<h2 id="相关知识">相关知识</h2>
<h3 id="外部输入触发">外部输入触发</h3>
<p>此功能允许使用 INPUT_SIGNAL 和 OUTPUT_SIGNAL 端口与第三方摄像机和系统进行有限形式的交互。</p>
<p>INPUT_SIGNAL 端口可以配置为检测来自另一个相机或电子系统的上升沿、下降沿和脉冲，当它检测到这种情况时，一个特殊的数据点会插入到来自 iniVation 相机的数据流中，精确的时间戳，允许将来自相机的数据与外部发生的事件相关联。</p>
<p>此功能可以检测理论最大频率为 1 MHz 的信号。对于方波输入，我们建议仅检测上升沿，频率不要超过 100 KHz，以获得可靠的结果。不尝试去抖或信号清除。</p>
<p>最好的情况是在外部摄像头捕获帧时仅发送脉冲，以便您可以将两者关联起来。许多机器视觉相机都支持这种触发器，例如外部 LED 灯闪烁。</p>
<p>这不会改变 iniVation 摄像机本身的操作方式，因此无法使用此功能在 DAVIS 上启动/停止录制、配置摄像机或触发帧捕获。</p>
<p>默认情况下，OUTPUT_SIGNAL 端口仅中继 INPUT_SIGNAL 端口，从而允许以菊花链方式连接此检测功能。一些 iniVation 相机还支持在此端口上生成类似 PWM 的信号作为可配置选项。</p>
<p>信号输出与相机操作没有直接关系；它不会发出相机状态变化的信号，例如开始/停止记录或数据采集。下表列出了支持此额外功能的所有相机。</p>
<p>所有这些都必须使用我们的软件进行配置和启用，这些选项通常称为“外部输入检测器”（用于 INPUT_SIGNAL 端口上的检测部分）和“外部输入发生器”（用于在 OUTPUT_SIGNAL 端口上生成可选 PWM 信号）。</p>
<h3 id="时钟同步">时钟同步</h3>
<p>时钟同步功能允许多个连接的摄像机使用 INPUT_CLOCK 和 OUTPUT_CLOCK 端口保持微秒精度时间戳彼此同步。</p>
<p>摄像机以菊花链方式连接，一旦通过电缆建立物理连接，它们就会自动同步。该系列中的第一台相机（INPUT_CLOCK 上没有信号的相机）称为主相机，并且其主 LED 会打开。其他摄像机的 LED 灯将关闭。还可以在我们的软件中检查同步状态，其中“deviceIsMaster”选项通常会通知用户相机的状态。</p>
<p>所有摄像机硬件同步后，您只需重置主摄像机的时间戳，然后主摄像机也会重置所有下游设备，确保所有摄像机具有相同的开始时间点。这是通过软件完成的，可以通过选择“Reset Timestamps”选项手动完成，也可以使用 dv-processing 的 Stereo 类自动完成此操作。</p>
<h2 id="硬件连接">硬件连接</h2>
<img src="/posts/9d7fd48f/%E5%8F%8C%E7%9B%AE%E7%A1%AC%E4%BB%B6%E8%BF%9E%E6%8E%A5.jpg" srcset="/img/loading.gif" lazyload class="" title="双目硬件连接">
<p>以左目相机为主相机，右目相机为副相机。同步线从右目相机的IN口出，到左目相机的OUT口进。两个相机都使用USB线连接到电脑上。</p>
<p>进行可视化（数据传输）时，左目相机MASTER灯和DATA灯亮，右目相机DATA灯亮。</p>
<h2 id="可视化">可视化</h2>
<h3 id="dv-gui">dv-gui</h3>
<p>运行<code>dv-gui</code>后，即可在右侧工具栏的Capture-INPUT SELECTION中选择两个相机之一。当然，也可以通过搭建Structure的方式同时可视化两个相机。</p>
<h3 id="rpg-dvs-ros-2">rpg_dvs_ros</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">source</span> ./devel/setup.zsh &amp;&amp; roslaunch dvs_renderer stereo_davis.launch<br></code></pre></td></tr></table></figure>
<h3 id="dv-ros（TODO）">dv-ros（TODO）</h3>
<h2 id="标定">标定</h2>
<p>步骤与单目相机类似：</p>
<ol>
<li><a href="#%E7%9B%B8%E6%9C%BA%E5%AF%B9%E7%84%A6">相机对焦</a></li>
<li><a href="#%E4%BD%BF%E7%94%A8Kalibr%E6%A0%87%E5%AE%9A%E7%9B%B8%E6%9C%BA%E5%86%85%E5%8F%82">使用Kalibr标定相机内参</a>，无非是在执行标定命令时比单目多指定一个topic。</li>
<li><a href="#%E4%BD%BF%E7%94%A8Kalibr%E8%BF%9B%E8%A1%8C%E8%A7%86%E6%83%AF%E8%81%94%E5%90%88%E6%A0%87%E5%AE%9A">使用Kalibr进行视惯联合标定</a>，无非是在执行标定命令时比单目多指定一个topic。</li>
</ol>
<h2 id="参考链接-2">参考链接</h2>
<ul>
<li><a target="_blank" rel="noopener" href="https://docs.inivation.com/hardware/hardware-advanced-usage/external-camera-sync.html">https://docs.inivation.com/hardware/hardware-advanced-usage/external-camera-sync.html</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.inivation.com/software/dv/gui/calibrate-event-camera.html">https://docs.inivation.com/software/dv/gui/calibrate-event-camera.html</a></li>
<li><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=rBT5O5TEOV4">https://www.youtube.com/watch?v=rBT5O5TEOV4</a> （35:09多相机校准）</li>
</ul>
<h1 id="Prophesee-EVK4">Prophesee/EVK4</h1>
<h2 id="驱动安装与可视化">驱动安装与可视化</h2>
<p><a target="_blank" rel="noopener" href="https://docs.prophesee.ai/stable/index.html">支持文档</a></p>
<blockquote>
<p>最好看自己支持的版本的文档，例如，<a target="_blank" rel="noopener" href="https://docs.prophesee.ai/3.1.2/">3.1.2版</a>。</p>
</blockquote>
<h3 id="SDK-Metavision-Studio">SDK/Metavision Studio</h3>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://docs.prophesee.ai/3.1.2/metavision_studio/index.html#chapter-metavision-studio">Metavision Studio</a> 是一个具有图形用户界面的应用程序，允许可视化和记录流式传输的数据 Prophesee 兼容的基于事件的视觉系统。它是作为 预构建的 Ubuntu 软件包包括 Prophesee 相机插件，因此您无需任何额外安装即可使用它。</p>
<p>如果您想部署我们的完整 SDK（Python 和 C++ API 以及相关代码示例）， 遵循具体指南： <a target="_blank" rel="noopener" href="https://docs.prophesee.ai/3.1.2/installation/linux.html#chapter-installation-linux">SDK安装</a> （请注意，完整的 SDK 安装还包含 Metavision Studio 应用程序）。</p>
<p>安装我们的开源项目<a target="_blank" rel="noopener" href="https://github.com/prophesee-ai/openeb">OpenEB</a> 请遵循具体指南：<a target="_blank" rel="noopener" href="https://docs.prophesee.ai/3.1.2/installation/linux_open_from_source.html#chapter-installation-linux-open-from-source">安装 OpenEB</a> 。</p>
</blockquote>
<ol>
<li>
<p><a target="_blank" rel="noopener" href="https://docs.prophesee.ai/stable/installation/index.html#chapter-installation-os-support">查看</a>自己的操作系统和相机共同支持的SDK版本。</p>
<blockquote>
<p>对于EVK4和Ubuntu18.04，我选择了SDK 3.1。因此，下面的步骤以3.1版本为例，仅供参考。以<a target="_blank" rel="noopener" href="https://docs.prophesee.ai/stable/index.html">官方文档</a>为准。</p>
</blockquote>
</li>
<li>
<p><a target="_blank" rel="noopener" href="https://support.prophesee.ai/portal/en/kb/prophesee-1/metavision-sdk/download-center">注册后获得邀请链接，获取</a>对应版本的APT存储库配置文件<code>metavision.list</code>。</p>
</li>
<li>
<p><a target="_blank" rel="noopener" href="https://docs.prophesee.ai/3.1.2/installation/linux_studio.html">安装 Metavision Studio</a>：</p>
<ol>
<li>
<p>清理您可能早期安装的 Prophesee 软件的源列表和首选项目录：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> /etc/apt/sources.list.d<br>sudo <span class="hljs-built_in">rm</span> prophesee.list essentials.list metavision.list designer.list<br>sudo <span class="hljs-built_in">rm</span> /etc/apt/preferences.d/prophesee<br></code></pre></td></tr></table></figure>
</li>
<li>
<p>将<a target="_blank" rel="noopener" href="https://www.prophesee.ai/metavision-intelligence-sdk-download-3-1">注册过程</a>中提供的新<code>metavision.list</code>文件复制到文件夹<code>/etc/apt/sources.list.d</code>将 Prophesee 的服务器添加到 APT 存储库列表中：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo <span class="hljs-built_in">cp</span> metavision.list /etc/apt/sources.list.d<br></code></pre></td></tr></table></figure>
</li>
<li>
<p>更新存储库和包的列表：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo apt update<br></code></pre></td></tr></table></figure>
</li>
<li>
<p>安装 Metavision Studio：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo apt -y install metavision-studio<br></code></pre></td></tr></table></figure>
</li>
<li>
<p>完成。</p>
</li>
</ol>
</li>
<li>
<p><a target="_blank" rel="noopener" href="https://docs.prophesee.ai/3.1.2/metavision_studio/index.html#chapter-metavision-studio">使用 Metavision Studio</a>：</p>
<ol>
<li>打开 Metavision Studio：
<ul>
<li>在操作系统的命令行提示符中键入<code>metavision_studio</code>。</li>
<li>Win+A快捷键打开应用菜单列表，选择<code>metavision_studio</code>。</li>
</ul>
</li>
<li>调整物镜的光圈和焦距以使图像变得清晰。</li>
<li>为了减少背景噪音，您可以打开偏差设置并调整bias_fo，同时跟踪事件发生率和 显示屏以查看噪声如何受到影响。要获取有关偏差的更多信息，请参阅 <a target="_blank" rel="noopener" href="https://docs.prophesee.ai/3.1.2/hw/manuals/biases.html#chapter-biases">传感器偏置页面</a>。</li>
</ol>
</li>
<li>
<p><a target="_blank" rel="noopener" href="https://docs.prophesee.ai/3.1.2/installation/linux.html">安装 SDK</a>：</p>
<ol>
<li>...</li>
</ol>
</li>
<li>
<p>完成。</p>
</li>
</ol>
<h3 id="OpenEB">OpenEB</h3>
<ol>
<li>
<p>在<a target="_blank" rel="noopener" href="https://github.com/prophesee-ai/openeb/releases">release</a>页面找到支持自己相机和操作系统的最新的版本，后下载和解压源码。</p>
<blockquote>
<p>对于EVK4和Ubuntu18.04，我选择了<a target="_blank" rel="noopener" href="https://github.com/prophesee-ai/openeb/releases/tag/3.1.2">v3.1.2</a>。</p>
</blockquote>
<blockquote>
<p>不同版本的编译过程可能存在不同，详见源码内的<code>README.md</code>，因此，以下内容仅供参考。</p>
</blockquote>
</li>
<li>
<p>安装依赖库：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo apt update<br>sudo apt -y install apt-utils build-essential software-properties-common wget unzip curl git cmake<br>sudo apt -y install libopencv-dev googletest libgtest-dev libboost-all-dev libusb-1.0-0-dev<br>sudo apt -y install libglew-dev libglfw3-dev libcanberra-gtk-module ffmpeg<br></code></pre></td></tr></table></figure>
</li>
<li>
<p>配置Python环境：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo apt -y install python3-pip python3-distutils<br><span class="hljs-comment"># we support Python 3.6 and 3.7 on Ubuntu 18.04 and Python 3.7 and 3.8 on Ubuntu 20.04</span><br>sudo apt -y install python3.X-dev  <span class="hljs-comment"># where X is 6, 7 or 8 depending on your Python version (3.6, 3.7 or 3.8)</span><br>python3 -V  <span class="hljs-comment"># 查看当前版本</span><br><br>python3 -m pip install pip --upgrade<br>python3 -m pip install <span class="hljs-string">&quot;opencv-python&gt;=4.5.5.64&quot;</span> <span class="hljs-string">&quot;sk-video==1.1.10&quot;</span> <span class="hljs-string">&quot;fire==0.4.0&quot;</span> <span class="hljs-string">&quot;numpy&lt;=1.21&quot;</span> pandas scipy h5py <br>python3 -m pip install jupyter jupyterlab matplotlib <span class="hljs-string">&quot;ipywidgets==7.6.5&quot;</span> pytest command_runner<br></code></pre></td></tr></table></figure>
</li>
<li>
<p>...</p>
</li>
<li>
<p>完成。</p>
</li>
</ol>
<h3 id="ROS支持">ROS支持</h3>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/prophesee-ai/prophesee_ros_wrapper">https://github.com/prophesee-ai/prophesee_ros_wrapper</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/prophesee-ai/prophesee_ros_stereo_driver">https://github.com/prophesee-ai/prophesee_ros_stereo_driver</a></li>
</ul>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/%E4%BA%8B%E4%BB%B6%E7%9B%B8%E6%9C%BA/" class="category-chain-item">事件相机</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>事件相机的选型、标定和使用</div>
      <div>http://zeyulong.com/posts/9d7fd48f/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>龙泽雨</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2024年4月20日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/posts/e3cf771c/" title="有意思的图表">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">有意思的图表</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/posts/c3a050a5/" title="ESVIO编译运行调试记录">
                        <span class="hidden-mobile">ESVIO编译运行调试记录</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  
  
    <article id="comments" lazyload>
      
  <div id="waline"></div>
  <script type="text/javascript">
    Fluid.utils.loadComments('#waline', function() {
      Fluid.utils.createCssLink('https://cdn.staticfile.org/waline/2.15.5/waline.min.css')
      Fluid.utils.createScript('https://cdn.staticfile.org/waline/2.15.5/waline.min.js', function() {
        var options = Object.assign(
          {"serverURL":"https://www.zeyulong.cn/","path":"window.location.pathname","meta":["nick","mail","link"],"requiredMeta":["nick"],"lang":"zh-CN","emoji":["https://cdn.jsdelivr.net/gh/walinejs/emojis/weibo"],"dark":"html[data-user-color-scheme=\"dark\"]","wordLimit":0,"pageSize":10,"reaction":true,"locale":{"placeholder":"花径不曾缘客扫，蓬门今始为君开。"}},
          {
            el: '#waline',
            path: window.location.pathname
          }
        )
        Waline.init(options);
        Fluid.utils.waitElementVisible('#waline .vcontent', () => {
          var imgSelector = '#waline .vcontent img:not(.vemoji)';
          Fluid.plugins.imageCaption(imgSelector);
          Fluid.plugins.fancyBox(imgSelector);
        })
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


    </article>
  


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> <div style="font-size: 0.85rem"> <span id="timeDate">载入天数...</span> <span id="times">载入时分秒...</span> <script src="/custom/RunTime/RunTime.js"></script> </div> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>





  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>




  
<script src="/custom/live2d/live2d-widget/autoload.js"></script>
<script src="/custom/live2d/jquery.min.js"></script>
<script src="/custom/LabelPage/LabelPage.js"></script>
<script src="/custom/LoadingBar/pace.min.js"></script>
<script src="/custom/ReadingProgress/ReadingProgress.js"></script>
<script src="/custom/typing-effect/typing-effect.js"></script>



<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  <canvas
    class="fireworks"
    style="position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; pointer-events: none; z-index: 32767"
></canvas>
<script type="text/javascript" src="/custom/fireworks/anime.min.js"></script> 
<script type="text/javascript" src="/custom/fireworks/fireworks.js"></script>

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
